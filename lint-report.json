[{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\api\\admin\\init\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is assigned a value but never used.","line":6,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\r\nimport { initializeDatabase } from '@/lib/turso/database';\r\n\r\nexport async function GET() {\r\n    try {\r\n        const db = await initializeDatabase();\r\n        return NextResponse.json({ status: 'ok', message: 'Database initialized' });\r\n    } catch (error) {\r\n        console.error('DB Init failed:', error);\r\n        return NextResponse.json({ error: 'Failed to init DB' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\api\\attribution\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ThreatId' is defined but never used.","line":3,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":44,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ThreatId"},"fix":{"range":[161,171],"text":""},"desc":"Remove unused variable \"ThreatId\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { generateAttributionBrief } from '@/lib/gemini/attribution';\r\nimport type { ThreatEvent, Signal, ThreatId, SignalId } from '@/lib/types';\r\n\r\n// Demo signals for testing without real data\r\nconst DEMO_SIGNALS: Signal[] = [\r\n    {\r\n        id: 'sig-1' as SignalId,\r\n        type: 'COMPETITOR_PRICE',\r\n        timestamp: new Date(Date.now() - 3600000),\r\n        value: 1379,\r\n        previousValue: 1499,\r\n        delta: -120,\r\n    },\r\n    {\r\n        id: 'sig-2' as SignalId,\r\n        type: 'CONVERSION_DROP',\r\n        timestamp: new Date(Date.now() - 1800000),\r\n        value: 2.1,\r\n        previousValue: 3.8,\r\n        delta: -1.7,\r\n    },\r\n];\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n        const threat = body.threat as ThreatEvent;\r\n\r\n        if (!threat || !threat.id || !threat.title) {\r\n            return NextResponse.json(\r\n                { error: 'Invalid threat data' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Use demo signals or provided signals\r\n        const signals = body.signals ?? DEMO_SIGNALS;\r\n\r\n        // Generate attribution brief using Gemini\r\n        const brief = await generateAttributionBrief(threat, signals);\r\n\r\n        return NextResponse.json(brief);\r\n    } catch (error) {\r\n        console.error('Attribution error:', error);\r\n        \r\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n        const errorStack = error instanceof Error ? error.stack : '';\r\n\r\n        // Check if it's an API key error\r\n        if (errorMessage.includes('API') || errorMessage.includes('key')) {\r\n            return NextResponse.json(\r\n                { error: 'Gemini API configuration error', details: errorMessage },\r\n                { status: 503 }\r\n            );\r\n        }\r\n\r\n        return NextResponse.json(\r\n            { \r\n                error: 'Attribution generation failed', \r\n                details: errorMessage,\r\n                stack: process.env.NODE_ENV === 'development' ? errorStack : undefined\r\n            },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\api\\ingest\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\api\\recommendations\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\api\\simulate\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\api\\status\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\charts\\AttributionBreakdownChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getSeverityColor' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":26,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"getSeverityColor"},"fix":{"range":[199,252],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1038,1041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1038,1041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1926,1929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1926,1929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\n/**\r\n * Attribution Breakdown Pie Chart\r\n * Shows revenue change attribution by factor\r\n */\r\n\r\nimport { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from 'recharts';\r\nimport { getSeverityColor } from '@/lib/chart-utils';\r\n\r\ninterface AttributionFactor {\r\n  factor: string;\r\n  contribution: number; // Percentage\r\n  impact: 'POSITIVE' | 'NEGATIVE' | 'NEUTRAL';\r\n}\r\n\r\ninterface AttributionBreakdownChartProps {\r\n  data: AttributionFactor[];\r\n  height?: number;\r\n}\r\n\r\nconst COLORS = {\r\n  POSITIVE: '#10b981',  // Green\r\n  NEGATIVE: '#ef4444',  // Red\r\n  NEUTRAL: '#06b6d4',   // Cyan\r\n};\r\n\r\nexport function AttributionBreakdownChart({ data, height = 300 }: AttributionBreakdownChartProps) {\r\n  // Transform data for Recharts\r\n  const chartData = data.map(item => ({\r\n    name: item.factor,\r\n    value: Math.abs(item.contribution),\r\n    impact: item.impact,\r\n    color: COLORS[item.impact],\r\n    displayValue: item.contribution, // Keep original sign for tooltip\r\n  }));\r\n\r\n  const renderCustomLabel = (entry: any) => {\r\n    return `${entry.value.toFixed(1)}%`;\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full\">\r\n      <ResponsiveContainer width=\"100%\" height={height}>\r\n        <PieChart>\r\n          <Pie\r\n            data={chartData}\r\n            cx=\"50%\"\r\n            cy=\"50%\"\r\n            labelLine={false}\r\n            label={renderCustomLabel}\r\n            outerRadius={100}\r\n            fill=\"#8884d8\"\r\n            dataKey=\"value\"\r\n          >\r\n            {chartData.map((entry, index) => (\r\n              <Cell key={`cell-${index}`} fill={entry.color} />\r\n            ))}\r\n          </Pie>\r\n          \r\n          <Tooltip \r\n            contentStyle={{ \r\n              backgroundColor: '#1f2937', \r\n              border: '1px solid #374151',\r\n              borderRadius: '8px',\r\n              color: '#f3f4f6'\r\n            }}\r\n            formatter={(value?: number, name?: string, props?: any) => {\r\n              if (!value || !props) return ['', ''];\r\n              const displayValue = props.payload.displayValue;\r\n              const sign = displayValue >= 0 ? '+' : '';\r\n              return [`${sign}${displayValue.toFixed(1)}%`, props.payload.impact];\r\n            }}\r\n          />\r\n          \r\n          <Legend \r\n            verticalAlign=\"bottom\"\r\n            height={36}\r\n            iconType=\"circle\"\r\n            wrapperStyle={{ color: '#9ca3af', fontSize: '12px' }}\r\n          />\r\n        </PieChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\charts\\OpportunityTrendChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\charts\\RevenueVelocityChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\charts\\RiskScoreGauge.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Legend' is defined but never used.","line":8,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":43,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Legend"},"fix":{"range":[152,160],"text":""},"desc":"Remove unused variable \"Legend\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\n/**\r\n * Risk Score Radial Gauge\r\n * Shows current risk score with color-coded severity zones\r\n */\r\n\r\nimport { RadialBarChart, RadialBar, Legend, ResponsiveContainer, PolarAngleAxis } from 'recharts';\r\nimport { getRiskScoreColor } from '@/lib/chart-utils';\r\n\r\ninterface RiskScoreGaugeProps {\r\n  riskScore: number; // 0-100\r\n  height?: number;\r\n  showLabel?: boolean;\r\n}\r\n\r\nexport function RiskScoreGauge({ \r\n  riskScore, \r\n  height = 200,\r\n  showLabel = true \r\n}: RiskScoreGaugeProps) {\r\n  // Clamp score to 0-100\r\n  const score = Math.max(0, Math.min(100, riskScore));\r\n  const color = getRiskScoreColor(score);\r\n  \r\n  // Data for radial bar\r\n  const data = [\r\n    {\r\n      name: 'Risk',\r\n      value: score,\r\n      fill: color,\r\n    },\r\n  ];\r\n\r\n  // Get severity text\r\n  const getSeverityText = (score: number) => {\r\n    if (score >= 70) return 'HIGH RISK';\r\n    if (score >= 50) return 'MEDIUM RISK';\r\n    if (score >= 30) return 'ELEVATED';\r\n    return 'LOW RISK';\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative w-full\" style={{ height }}>\r\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n        <RadialBarChart\r\n          cx=\"50%\"\r\n          cy=\"50%\"\r\n          innerRadius=\"60%\"\r\n          outerRadius=\"90%\"\r\n          barSize={20}\r\n          data={data}\r\n          startAngle={180}\r\n          endAngle={0}\r\n        >\r\n          <PolarAngleAxis\r\n            type=\"number\"\r\n            domain={[0, 100]}\r\n            angleAxisId={0}\r\n            tick={false}\r\n          />\r\n          \r\n          <RadialBar\r\n            background={{ fill: '#1f2937' }}\r\n            dataKey=\"value\"\r\n            cornerRadius={10}\r\n            fill={color}\r\n          />\r\n        </RadialBarChart>\r\n      </ResponsiveContainer>\r\n      \r\n      {/* Center label */}\r\n      {showLabel && (\r\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center pointer-events-none\">\r\n          <div className=\"text-4xl font-bold\" style={{ color }}>\r\n            {score}\r\n          </div>\r\n          <div className=\"text-xs text-gray-400 mt-1\">\r\n            {getSeverityText(score)}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\charts\\SignalHeatmap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startOfWeek' is defined but never used.","line":9,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"startOfWeek"},"fix":{"range":[177,190],"text":""},"desc":"Remove unused variable \"startOfWeek\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'endOfWeek' is defined but never used.","line":9,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":40,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"endOfWeek"},"fix":{"range":[190,201],"text":""},"desc":"Remove unused variable \"endOfWeek\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cellGap' is assigned a value but never used.","line":77,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\n/**\r\n * Signal Heatmap Calendar\r\n * Shows signal intensity over time (GitHub-style contribution graph)\r\n */\r\n\r\nimport { useMemo } from 'react';\r\nimport { format, startOfWeek, endOfWeek, eachDayOfInterval, subDays } from 'date-fns';\r\nimport { type SignalHeatmapData } from '@/lib/chart-utils';\r\n\r\ninterface SignalHeatmapProps {\r\n  data: SignalHeatmapData[];\r\n  days?: number;\r\n  height?: number;\r\n}\r\n\r\nexport function SignalHeatmap({ data, days = 30, height = 150 }: SignalHeatmapProps) {\r\n  // Group data by date\r\n  const heatmapData = useMemo(() => {\r\n    const now = new Date();\r\n    const startDate = subDays(now, days);\r\n    const dateRange = eachDayOfInterval({ start: startDate, end: now });\r\n\r\n    // Create map of date -> average intensity\r\n    // Create map of date -> list of intensities\r\n    const intensityMap = new Map<string, number[]>();\r\n\r\n    data.forEach(point => {\r\n      const dateKey = format(point.date, 'yyyy-MM-dd');\r\n      const current = intensityMap.get(dateKey) || [];\r\n      intensityMap.set(dateKey, [...current, point.intensity]);\r\n    });\r\n\r\n    // Calculate average intensity per day\r\n    return dateRange.map(date => {\r\n      const dateKey = format(date, 'yyyy-MM-dd');\r\n      const intensities = intensityMap.get(dateKey) || [];\r\n      const avgIntensity = intensities.length > 0\r\n        ? intensities.reduce((a, b) => a + b, 0) / intensities.length\r\n        : 0;\r\n\r\n      return {\r\n        date,\r\n        dateKey,\r\n        intensity: avgIntensity,\r\n      };\r\n    });\r\n  }, [data, days]);\r\n\r\n  // Get color based on intensity\r\n  const getColor = (intensity: number) => {\r\n    if (intensity === 0) return '#1f2937'; // Gray-800\r\n    if (intensity < 25) return '#065f46'; // Green-800\r\n    if (intensity < 50) return '#047857'; // Green-700\r\n    if (intensity < 75) return '#059669'; // Green-600\r\n    return '#10b981'; // Green-500\r\n  };\r\n\r\n  // Group by weeks\r\n  const weeks = useMemo(() => {\r\n    const result: typeof heatmapData[] = [];\r\n    let currentWeek: typeof heatmapData = [];\r\n\r\n    heatmapData.forEach((day, index) => {\r\n      currentWeek.push(day);\r\n      if ((index + 1) % 7 === 0 || index === heatmapData.length - 1) {\r\n        result.push([...currentWeek]);\r\n        currentWeek = [];\r\n      }\r\n    });\r\n\r\n    return result;\r\n  }, [heatmapData]);\r\n\r\n  const cellSize = 12;\r\n  const cellGap = 3;\r\n\r\n  return (\r\n    <div className=\"w-full overflow-x-auto\" style={{ height }}>\r\n      <div className=\"inline-flex gap-1\">\r\n        {weeks.map((week, weekIndex) => (\r\n          <div key={weekIndex} className=\"flex flex-col gap-1\">\r\n            {week.map((day) => (\r\n              <div\r\n                key={day.dateKey}\r\n                className=\"rounded-sm transition-all hover:ring-2 hover:ring-signal-cyan cursor-pointer\"\r\n                style={{\r\n                  width: cellSize,\r\n                  height: cellSize,\r\n                  backgroundColor: getColor(day.intensity),\r\n                }}\r\n                title={`${format(day.date, 'MMM dd, yyyy')}: ${Math.round(day.intensity)} signals`}\r\n              />\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Legend */}\r\n      <div className=\"flex items-center gap-2 mt-4 text-xs text-text-tertiary font-mono\">\r\n        <span>Less</span>\r\n        {[0, 20, 40, 60, 80].map(intensity => (\r\n          <div\r\n            key={intensity}\r\n            className=\"rounded-sm\"\r\n            style={{\r\n              width: cellSize,\r\n              height: cellSize,\r\n              backgroundColor: getColor(intensity),\r\n            }}\r\n          />\r\n        ))}\r\n        <span>More</span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\charts\\ThreatDistributionChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1984,1987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1984,1987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\n/**\r\n * Threat Distribution Bar Chart\r\n * Shows count of threats by type, color-coded by severity\r\n */\r\n\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'recharts';\r\nimport { getSeverityColor, type ThreatDistribution } from '@/lib/chart-utils';\r\n\r\ninterface ThreatDistributionChartProps {\r\n  data: ThreatDistribution[];\r\n  height?: number;\r\n}\r\n\r\nexport function ThreatDistributionChart({\r\n  data,\r\n  height = 300\r\n}: ThreatDistributionChartProps) {\r\n  // Transform data for Recharts\r\n  const chartData = data.map(item => ({\r\n    type: item.type.replace(/_/g, ' '),\r\n    count: item.count,\r\n    severity: item.severity,\r\n    color: getSeverityColor(item.severity),\r\n  }));\r\n\r\n  return (\r\n    <div className=\"w-full\">\r\n      <ResponsiveContainer width=\"100%\" height={height}>\r\n        <BarChart\r\n          data={chartData}\r\n          margin={{ top: 5, right: 30, left: 20, bottom: 60 }}\r\n        >\r\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" opacity={0.3} />\r\n\r\n          <XAxis\r\n            dataKey=\"type\"\r\n            stroke=\"#9ca3af\"\r\n            tick={{ fill: '#9ca3af', fontSize: 11 }}\r\n            tickLine={{ stroke: '#4b5563' }}\r\n            angle={-45}\r\n            textAnchor=\"end\"\r\n            height={80}\r\n          />\r\n\r\n          <YAxis\r\n            stroke=\"#9ca3af\"\r\n            tick={{ fill: '#9ca3af', fontSize: 12 }}\r\n            tickLine={{ stroke: '#4b5563' }}\r\n            label={{\r\n              value: 'Threat Count',\r\n              angle: -90,\r\n              position: 'insideLeft',\r\n              style: { fill: '#9ca3af', fontSize: 12 }\r\n            }}\r\n          />\r\n\r\n          <Tooltip\r\n            contentStyle={{\r\n              backgroundColor: '#1f2937',\r\n              border: '1px solid #374151',\r\n              borderRadius: '8px',\r\n              color: '#f3f4f6'\r\n            }}\r\n            formatter={(value: number | undefined, name: string | undefined, props: any) => [\r\n              `${value ?? 0} threats`,\r\n              props.payload.severity\r\n            ]}\r\n            labelStyle={{ color: '#06b6d4' }}\r\n          />\r\n\r\n          <Bar\r\n            dataKey=\"count\"\r\n            radius={[8, 8, 0, 0]}\r\n          >\r\n            {chartData.map((entry, index) => (\r\n              <Cell key={`cell-${index}`} fill={entry.color} />\r\n            ))}\r\n          </Bar>\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\charts\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\feed\\AttributionBrief.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\feed\\AttributionBrief.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AttributionBrief' is defined but never used.","line":5,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AttributionBrief"},"fix":{"range":[167,184],"text":""},"desc":"Remove unused variable \"AttributionBrief\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":137,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":137,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'brief?.threatId', 'selectedThreat', and 'setAttributionBrief'. Either include them or remove the dependency array.","line":144,"column":8,"nodeType":"ArrayExpression","endLine":144,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [brief?.threatId, selectedThreat, selectedThreat.id, setAttributionBrief]","fix":{"range":[5216,5236],"text":"[brief?.threatId, selectedThreat, selectedThreat.id, setAttributionBrief]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useSelectedThreat, useAttributionBrief, useSellerOpsStore } from '@/lib/store';\r\nimport type { AttributionBrief, CausalFactor, SuggestedAction } from '@/lib/types';\r\n\r\n// === TYPING EFFECT HOOK ===\r\nfunction useTypingEffect(text: string, speed: number = 30) {\r\n    const [displayedText, setDisplayedText] = useState('');\r\n    const [isComplete, setIsComplete] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!text) {\r\n            setDisplayedText('');\r\n            setIsComplete(true);\r\n            return;\r\n        }\r\n\r\n        setDisplayedText('');\r\n        setIsComplete(false);\r\n        let index = 0;\r\n\r\n        const timer = setInterval(() => {\r\n            if (index < text.length) {\r\n                setDisplayedText((prev) => prev + text[index]);\r\n                index++;\r\n            } else {\r\n                setIsComplete(true);\r\n                clearInterval(timer);\r\n            }\r\n        }, speed);\r\n\r\n        return () => clearInterval(timer);\r\n    }, [text, speed]);\r\n\r\n    return { displayedText, isComplete };\r\n}\r\n\r\n// === CAUSAL FACTOR CARD ===\r\nfunction CausalFactorCard({ factor, index }: { factor: CausalFactor; index: number }) {\r\n    const getImpactColor = () => {\r\n        switch (factor.impact) {\r\n            case 'HIGH': return 'text-signal-red';\r\n            case 'MEDIUM': return 'text-signal-amber';\r\n            case 'LOW': return 'text-signal-cyan';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className=\"hud-panel p-3 animate-slide-in\"\r\n            style={{ animationDelay: `${index * 100}ms` }}\r\n        >\r\n            <div className=\"flex items-start gap-3\">\r\n                <span className={`font-mono text-lg font-bold ${getImpactColor()}`}>\r\n                    {index + 1}\r\n                </span>\r\n                <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                        <span className=\"font-mono text-sm font-bold text-text-primary\">\r\n                            {factor.factor}\r\n                        </span>\r\n                        <span className={`px-2 py-0.5 text-xs font-mono uppercase ${getImpactColor()} bg-surface-overlay`}>\r\n                            {factor.impact}\r\n                        </span>\r\n                    </div>\r\n                    <p className=\"font-mono text-xs text-text-secondary\">\r\n                        {factor.evidence}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// === ACTION CARD ===\r\nfunction ActionCard({ action, index }: { action: SuggestedAction; index: number }) {\r\n    const getPriorityColor = () => {\r\n        switch (action.priority) {\r\n            case 'IMMEDIATE': return 'bg-signal-red text-white';\r\n            case 'SOON': return 'bg-signal-amber text-black';\r\n            case 'OPTIONAL': return 'bg-signal-cyan text-black';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className=\"hud-panel p-3 animate-slide-in border-l-4 border-signal-green\"\r\n            style={{ animationDelay: `${(index + 3) * 100}ms` }}\r\n        >\r\n            <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                <span className=\"font-mono text-sm font-bold text-text-primary\">\r\n                    ΓåÆ {action.action}\r\n                </span>\r\n                <span className={`px-2 py-0.5 text-xs font-mono font-bold ${getPriorityColor()}`}>\r\n                    {action.priority}\r\n                </span>\r\n            </div>\r\n            <p className=\"font-mono text-xs text-text-secondary\">\r\n                Expected: {action.expectedOutcome}\r\n            </p>\r\n        </div>\r\n    );\r\n}\r\n\r\n// === ATTRIBUTION BRIEF PANEL ===\r\nexport function AttributionBriefPanel() {\r\n    const selectedThreat = useSelectedThreat();\r\n    const brief = useAttributionBrief();\r\n    const isLoadingBrief = useSellerOpsStore((s) => s.isLoadingBrief);\r\n    const setAttributionBrief = useSellerOpsStore((s) => s.setAttributionBrief);\r\n\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Load brief when threat changes\r\n    useEffect(() => {\r\n        const fetchBrief = async () => {\r\n            if (selectedThreat) {\r\n                // If we already have a brief *for this threat*, don't refetch\r\n                if (brief?.threatId === selectedThreat.id) return;\r\n\r\n                setError(null);\r\n                setAttributionBrief(null); // Clear previous\r\n\r\n                try {\r\n                    const response = await fetch('/api/attribution', {\r\n                        method: 'POST',\r\n                        body: JSON.stringify({ threat: selectedThreat }),\r\n                    });\r\n\r\n                    if (response.ok) {\r\n                        const realBrief = await response.json();\r\n                        setAttributionBrief(realBrief);\r\n                    } else {\r\n                        setError('Attribution server unavailable.');\r\n                    }\r\n                } catch (err) {\r\n                    setError('Failed to connect to Intelligence Core.');\r\n                }\r\n            }\r\n        };\r\n\r\n        fetchBrief();\r\n    }, [selectedThreat?.id]);\r\n\r\n    const displayBrief = brief;\r\n    const { displayedText, isComplete } = useTypingEffect(\r\n        error || (displayBrief?.summary ?? (isLoadingBrief ? 'Analyzing signals...' : '')),\r\n        20\r\n    );\r\n\r\n    if (!selectedThreat) {\r\n        return (\r\n            <div className=\"flex-1 flex items-center justify-center p-8 bg-surface-base\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"w-16 h-16 mx-auto mb-4 border-2 border-border-default flex items-center justify-center\">\r\n                        <span className=\"font-mono text-2xl text-text-tertiary\">ΓùÄ</span>\r\n                    </div>\r\n                    <h3 className=\"font-mono text-lg text-text-secondary mb-2\">\r\n                        No Threat Selected\r\n                    </h3>\r\n                    <p className=\"font-mono text-sm text-text-tertiary\">\r\n                        Select a threat from the feed to view its attribution analysis\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex-1 p-6 bg-surface-base overflow-y-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n                <div className=\"w-10 h-10 bg-signal-green flex items-center justify-center\">\r\n                    <span className=\"font-mono font-bold text-black text-xl\">AI</span>\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"font-mono text-xl font-bold text-text-primary\">\r\n                        ATTRIBUTION BRIEF\r\n                    </h2>\r\n                    <p className=\"font-mono text-xs text-text-tertiary uppercase tracking-wider\">\r\n                        AI Analysis ΓÇó Confidence {displayBrief?.confidence ?? 0}%\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary with typing effect */}\r\n            <div className=\"hud-panel p-4 mb-6\">\r\n                <h3 className=\"font-mono text-xs text-text-tertiary uppercase tracking-wider mb-2\">\r\n                    Executive Summary\r\n                </h3>\r\n                <p className=\"font-mono text-sm text-text-primary leading-relaxed\">\r\n                    {displayedText}\r\n                    {!isComplete && <span className=\"animate-terminal-blink\">Γûî</span>}\r\n                </p>\r\n            </div>\r\n\r\n            {isComplete && displayBrief && (\r\n                <>\r\n                    {/* Causal Factors */}\r\n                    <div className=\"mb-6\">\r\n                        <h3 className=\"font-mono text-sm font-bold text-text-primary uppercase tracking-wider mb-3\">\r\n                            Root Causes\r\n                        </h3>\r\n                        <div className=\"space-y-2\">\r\n                            {displayBrief.causes.map((factor, i) => (\r\n                                <CausalFactorCard key={i} factor={factor} index={i} />\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Suggested Actions */}\r\n                    <div>\r\n                        <h3 className=\"font-mono text-sm font-bold text-text-primary uppercase tracking-wider mb-3\">\r\n                            Recommended Actions\r\n                        </h3>\r\n                        <div className=\"space-y-2\">\r\n                            {displayBrief.suggestedActions.map((action, i) => (\r\n                                <ActionCard key={i} action={action} index={i} />\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Action Button */}\r\n                    <div className=\"mt-6 flex gap-3\">\r\n                        <button className=\"flex-1 py-3 px-4 bg-signal-green text-black font-mono text-sm font-bold uppercase tracking-wider hover:bg-signal-amber transition-colors\">\r\n                            Execute Top Action\r\n                        </button>\r\n                        <button className=\"py-3 px-4 border border-border-default font-mono text-sm text-text-secondary hover:text-signal-cyan hover:border-signal-cyan transition-colors\">\r\n                            Simulate First\r\n                        </button>\r\n                    </div>\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\feed\\ThreatFeed.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used.","line":2,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":35,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"fireEvent"},"fix":{"range":[87,98],"text":""},"desc":"Remove unused variable \"fireEvent\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { render, screen, fireEvent } from '@testing-library/react';\r\nimport { ThreatFeed } from '@/components/feed/ThreatFeed';\r\n\r\n// Mock the store\r\nconst mockSelectThreat = vi.fn();\r\n\r\nvi.mock('@/lib/store', () => ({\r\n    useThreats: vi.fn(() => []),\r\n    useSelectedThreat: vi.fn(() => null),\r\n    useSellerOpsStore: vi.fn((selector) => {\r\n        if (typeof selector === 'function') {\r\n            return selector({ selectThreat: mockSelectThreat });\r\n        }\r\n        return { selectThreat: mockSelectThreat };\r\n    }),\r\n}));\r\n\r\ndescribe('ThreatFeed', () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it('should render the feed header', () => {\r\n        render(<ThreatFeed />);\r\n\r\n        expect(screen.getByText('Threat Feed')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should show demo threats when no data provided', () => {\r\n        render(<ThreatFeed />);\r\n\r\n        // Should show demo threat cards\r\n        expect(screen.getByText('Buy Box Lost - SKU #334')).toBeInTheDocument();\r\n        expect(screen.getByText('Refund Spike Detected')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should display severity badges', () => {\r\n        render(<ThreatFeed />);\r\n\r\n        // Should have CRITICAL and WARNING badges\r\n        expect(screen.getAllByText('CRITICAL').length).toBeGreaterThan(0);\r\n        expect(screen.getAllByText('WARNING').length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should show View All History button', () => {\r\n        render(<ThreatFeed />);\r\n\r\n        expect(screen.getByText('View All History ΓåÆ')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should display confidence levels', () => {\r\n        render(<ThreatFeed />);\r\n\r\n        // Demo threats have confidence of 94, 87, etc.\r\n        expect(screen.getByText(/Confidence: 94%/)).toBeInTheDocument();\r\n    });\r\n\r\n    it('should show suggested actions when available', () => {\r\n        render(<ThreatFeed />);\r\n\r\n        expect(screen.getByText(/Match price to regain Buy Box/)).toBeInTheDocument();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\feed\\ThreatFeed.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\feed\\ThreatFeed.tsx:37:37\n  35 | function ThreatCard({ threat, isSelected, onClick }: ThreatCardProps) {\n  36 |     const timeSince = (date: Date) => {\n> 37 |         const seconds = Math.floor((Date.now() - date.getTime()) / 1000);\n     |                                     ^^^^^^^^^^ Cannot call impure function\n  38 |         if (seconds < 60) return `${seconds}s ago`;\n  39 |         if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n  40 |         return `${Math.floor(seconds / 3600)}h ago`;","line":37,"column":37,"nodeType":null,"endLine":37,"endColumn":47}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useThreats, useSelectedThreat, useSellerOpsStore } from '@/lib/store';\r\nimport type { ThreatEvent, SeverityLevel } from '@/lib/types';\r\n\r\n// === SEVERITY BADGE ===\r\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\r\n    const getClasses = () => {\r\n        switch (severity) {\r\n            case 'CRITICAL':\r\n                return 'signal-critical animate-pulse-glow';\r\n            case 'WARNING':\r\n                return 'signal-warning';\r\n            case 'INFO':\r\n                return 'signal-info';\r\n            case 'OK':\r\n                return 'signal-ok';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <span className={`px-2 py-0.5 text-xs font-mono font-bold uppercase ${getClasses()}`}>\r\n            {severity}\r\n        </span>\r\n    );\r\n}\r\n\r\n// === THREAT CARD ===\r\ninterface ThreatCardProps {\r\n    threat: ThreatEvent;\r\n    isSelected: boolean;\r\n    onClick: () => void;\r\n}\r\n\r\nfunction ThreatCard({ threat, isSelected, onClick }: ThreatCardProps) {\r\n    const timeSince = (date: Date) => {\r\n        const seconds = Math.floor((Date.now() - date.getTime()) / 1000);\r\n        if (seconds < 60) return `${seconds}s ago`;\r\n        if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\r\n        return `${Math.floor(seconds / 3600)}h ago`;\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={onClick}\r\n            className={`\r\n        w-full text-left p-3 hud-panel transition-all duration-200\r\n        ${isSelected\r\n                    ? 'border-signal-green hud-panel-glow'\r\n                    : 'hover:border-text-tertiary'\r\n                }\r\n        animate-slide-in\r\n      `}\r\n        >\r\n            <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                <SeverityBadge severity={threat.severity} />\r\n                <span className=\"font-mono text-xs text-text-tertiary\">\r\n                    {timeSince(threat.detectedAt)}\r\n                </span>\r\n            </div>\r\n\r\n            <h3 className=\"font-mono text-sm font-bold text-text-primary mb-1 leading-tight\">\r\n                {threat.title}\r\n            </h3>\r\n\r\n            <p className=\"font-mono text-xs text-text-secondary line-clamp-2\">\r\n                {threat.description}\r\n            </p>\r\n\r\n            {threat.suggestedAction && (\r\n                <div className=\"mt-2 pt-2 border-t border-border-default\">\r\n                    <span className=\"font-mono text-xs text-signal-cyan\">\r\n                        ΓåÆ {threat.suggestedAction}\r\n                    </span>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"mt-2 flex items-center justify-between\">\r\n                <span className=\"font-mono text-xs text-text-tertiary\">\r\n                    Confidence: {threat.confidence}%\r\n                </span>\r\n                <span className=\"font-mono text-xs text-text-tertiary\">\r\n                    {threat.signals.length} signals\r\n                </span>\r\n            </div>\r\n        </button>\r\n    );\r\n}\r\n\r\n// === THREAT FEED ===\r\nexport function ThreatFeed({ onClose }: { onClose?: () => void }) {\r\n    const threats = useThreats();\r\n    const selectedThreat = useSelectedThreat();\r\n    const selectThreat = useSellerOpsStore((s) => s.selectThreat);\r\n\r\n    const displayThreats = threats; // Use ONLY real threats from store\r\n\r\n    return (\r\n        <aside className=\"w-full md:w-80 h-full bg-surface-base border-r border-border-default flex flex-col\">\r\n            {/* Header */}\r\n            <div className=\"p-3 border-b border-border-default\">\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-2 h-2 bg-signal-red animate-pulse-glow\" />\r\n                        <h2 className=\"font-mono text-sm font-bold uppercase tracking-wider text-text-primary\">\r\n                            Threat Feed\r\n                        </h2>\r\n                    </div>\r\n                    {/* Close button for mobile */}\r\n                    {onClose && (\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"md:hidden text-text-secondary hover:text-text-primary text-xl\"\r\n                            aria-label=\"Close threat feed\"\r\n                        >\r\n                            Γ£ò\r\n                        </button>\r\n                    )}\r\n                </div>\r\n                <p className=\"font-mono text-xs text-text-tertiary mt-1\">\r\n                    {displayThreats.length} active ΓÇó Click to analyze\r\n                </p>\r\n            </div>\r\n\r\n            {/* Threat List */}\r\n            <div className=\"flex-1 overflow-y-auto p-2 space-y-2\">\r\n                {displayThreats.map((threat) => (\r\n                    <ThreatCard\r\n                        key={threat.id}\r\n                        threat={threat}\r\n                        isSelected={selectedThreat?.id === threat.id}\r\n                        onClick={() => selectThreat(threat)}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"p-3 border-t border-border-default\">\r\n                <button className=\"w-full py-2 px-3 font-mono text-xs uppercase tracking-wider text-text-secondary hover:text-signal-green transition-colors border border-border-default hover:border-signal-green\">\r\n                    View All History ΓåÆ\r\n                </button>\r\n            </div>\r\n        </aside>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\metrics\\LiveStatusBar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\metrics\\LiveStatusBar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LiveStatus' is defined but never used.","line":4,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"LiveStatus"},"fix":{"range":[77,88],"text":""},"desc":"Remove unused variable \"LiveStatus\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useLiveStatus } from '@/lib/store';\r\nimport type { LiveStatus, SeverityLevel } from '@/lib/types';\r\n\r\n// === METRIC CARD COMPONENT ===\r\ninterface MetricCardProps {\r\n    label: string;\r\n    value: string | number;\r\n    direction?: 'UP' | 'DOWN' | 'STABLE';\r\n    severity?: SeverityLevel;\r\n}\r\n\r\nfunction MetricCard({ label, value, direction, severity }: MetricCardProps) {\r\n    const getDirectionIcon = () => {\r\n        switch (direction) {\r\n            case 'UP': return 'Γåæ';\r\n            case 'DOWN': return 'Γåô';\r\n            default: return 'ΓåÆ';\r\n        }\r\n    };\r\n\r\n    const getSeverityClass = () => {\r\n        switch (severity) {\r\n            case 'CRITICAL': return 'text-signal-red';\r\n            case 'WARNING': return 'text-signal-amber';\r\n            case 'OK': return 'text-signal-green';\r\n            default: return 'text-signal-cyan';\r\n        }\r\n    };\r\n\r\n    const getDirectionClass = () => {\r\n        switch (direction) {\r\n            case 'UP': return 'text-signal-green';\r\n            case 'DOWN': return 'text-signal-red';\r\n            default: return 'text-text-secondary';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"hud-panel px-4 py-3 flex flex-col gap-1\">\r\n            <span className=\"text-xs uppercase tracking-wider text-text-tertiary font-mono\">\r\n                {label}\r\n            </span>\r\n            <div className=\"flex items-baseline gap-2\">\r\n                <span className={`text-2xl font-bold font-mono ${getSeverityClass()}`}>\r\n                    {value}\r\n                </span>\r\n                {direction && (\r\n                    <span className={`text-lg font-mono ${getDirectionClass()}`}>\r\n                        {getDirectionIcon()}\r\n                    </span>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// === THREAT INDICATOR ===\r\nfunction ThreatIndicator({ count, severity }: { count: number; severity: SeverityLevel }) {\r\n    const getIndicatorClass = () => {\r\n        if (count === 0) return 'bg-signal-green';\r\n        switch (severity) {\r\n            case 'CRITICAL': return 'bg-signal-red animate-pulse-glow';\r\n            case 'WARNING': return 'bg-signal-amber';\r\n            default: return 'bg-signal-cyan';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"hud-panel px-4 py-3 flex items-center gap-3\">\r\n            <div className={`w-3 h-3 ${getIndicatorClass()}`} />\r\n            <div className=\"flex flex-col\">\r\n                <span className=\"text-xs uppercase tracking-wider text-text-tertiary font-mono\">\r\n                    Active Threats\r\n                </span>\r\n                <span className={`text-2xl font-bold font-mono ${count > 0 ? 'text-signal-red' : 'text-signal-green'\r\n                    }`}>\r\n                    {count}\r\n                </span>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// === MAIN STATUS BAR ===\r\nexport function LiveStatusBar() {\r\n    const status = useLiveStatus();\r\n\r\n    if (!status) {\r\n        return (\r\n            <header className=\"w-full bg-surface-base border-b border-border-default h-20 flex items-center justify-between px-4 animate-pulse\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-8 h-8 bg-surface-elevated\" />\r\n                    <div className=\"h-8 w-32 bg-surface-elevated\" />\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    {[1, 2, 3, 4].map(i => (\r\n                        <div key={i} className=\"h-14 w-32 bg-surface-elevated\" />\r\n                    ))}\r\n                </div>\r\n                <div className=\"h-8 w-24 bg-surface-elevated\" />\r\n            </header>\r\n        );\r\n    }\r\n\r\n    const getRiskSeverity = (score: number): SeverityLevel => {\r\n        if (score >= 70) return 'CRITICAL';\r\n        if (score >= 40) return 'WARNING';\r\n        return 'OK';\r\n    };\r\n\r\n    return (\r\n        <header className=\"w-full bg-surface-base border-b border-border-default\">\r\n            <div className=\"flex items-center justify-between px-4 py-2\">\r\n                {/* Logo / Title */}\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-8 h-8 bg-signal-green flex items-center justify-center\">\r\n                        <span className=\"font-mono font-bold text-black\">SO</span>\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"font-mono text-lg font-bold tracking-tight text-text-primary\">\r\n                            SELLEROPS\r\n                        </h1>\r\n                        <span className=\"font-mono text-xs text-text-tertiary uppercase tracking-widest\">\r\n                            War Room Active\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Metrics Grid */}\r\n                <div className=\"flex gap-2\">\r\n                    <MetricCard\r\n                        label=\"Revenue Velocity\"\r\n                        value={`Γé╣${status.revenueVelocity.toLocaleString()}/hr`}\r\n                        direction={status.revenueDirection}\r\n                    />\r\n                    <MetricCard\r\n                        label=\"Risk Score\"\r\n                        value={status.riskScore}\r\n                        severity={getRiskSeverity(status.riskScore)}\r\n                    />\r\n                    <MetricCard\r\n                        label=\"Opportunity\"\r\n                        value={status.opportunityScore}\r\n                        severity={status.opportunityScore > 50 ? 'OK' : 'INFO'}\r\n                    />\r\n                    <ThreatIndicator\r\n                        count={status.activeThreats}\r\n                        severity={status.activeThreats >= 1 ? (status.activeThreats >= 3 ? 'CRITICAL' : 'WARNING') : 'OK'}\r\n                    />\r\n                </div>\r\n\r\n                {/* Timestamp */}\r\n                <div className=\"text-right\">\r\n                    <span className=\"font-mono text-xs text-text-tertiary block\">\r\n                        Last Update\r\n                    </span>\r\n                    <span className=\"font-mono text-sm text-text-secondary\" suppressHydrationWarning>\r\n                        {new Date(status.lastUpdated).toLocaleTimeString()}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n        </header>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\recommendations\\SmartRecommendationsPanel.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'catalog'. Either include it or remove the dependency array.","line":151,"column":8,"nodeType":"ArrayExpression","endLine":151,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [catalog, mounted]","fix":{"range":[4847,4856],"text":"[catalog, mounted]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":440,"column":56,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click &quot;Generate\" to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click &ldquo;Generate\" to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click &#34;Generate\" to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click &rdquo;Generate\" to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":440,"column":65,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click \"Generate&quot; to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click \"Generate&ldquo; to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click \"Generate&#34; to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[21652,21816],"text":"\r\n                            Select a product and click \"Generate&rdquo; to see AI-powered intelligent recommendations with strategic insights.\r\n                        "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Smart Recommendations Panel Component\r\n * Showcases Gemini AI as primary recommendation engine\r\n * with optional TensorFlow similarity enhancement\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\n\r\ninterface Product {\r\n    id: string;\r\n    name: string;\r\n    category: string;\r\n    price: number;\r\n    keywords: string[];\r\n    description: string;\r\n}\r\n\r\ninterface RecommendationResponse {\r\n    targetProduct: Product;\r\n    recommendations: Array<{\r\n        product: Product;\r\n        score: number;\r\n        reason: string;\r\n        insights: string[];\r\n    }>;\r\n    strategy: string;\r\n    confidence: number;\r\n    analysis: {\r\n        summary: string;\r\n        insights: Array<{\r\n            type: string;\r\n            title: string;\r\n            description: string;\r\n            actionable: boolean;\r\n        }>;\r\n        bundleOpportunities: Array<{\r\n            products: string[];\r\n            discount: number;\r\n            expectedValue: number;\r\n            reason: string;\r\n        }>;\r\n        pricingStrategy: string;\r\n        expectedImpact: {\r\n            revenueIncrease: string;\r\n            conversionBoost: string;\r\n        };\r\n    };\r\n    powered: {\r\n        gemini: boolean;\r\n        tensorflow: boolean;\r\n        backend: string;\r\n    };\r\n    catalog: {\r\n        totalProducts: number;\r\n        categories: string[];\r\n        generatedAt: string;\r\n    };\r\n}\r\n\r\ninterface ProductCatalog {\r\n    products: Product[];\r\n    totalProducts: number;\r\n    categories: string[];\r\n    totalValue: number;\r\n    generatedAt: string;\r\n    context: string;\r\n    powered: {\r\n        gemini: boolean;\r\n        tensorflow: boolean;\r\n    };\r\n    tensorFlowBackend: string;\r\n    tensorFlowReady: boolean;\r\n}\r\n\r\nexport function SmartRecommendationsPanel() {\r\n    const [catalog, setCatalog] = useState<ProductCatalog | null>(null);\r\n    const [selectedProductId, setSelectedProductId] = useState<string>('');\r\n    const [result, setResult] = useState<RecommendationResponse | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [useTensorFlow, setUseTensorFlow] = useState(false);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isLoadingCatalog, setIsLoadingCatalog] = useState(false);\r\n\r\n    // Client-side only initialization\r\n    if (typeof window !== 'undefined' && !mounted) {\r\n        setMounted(true);\r\n    }\r\n\r\n    // Load product catalog (Gemini-generated)\r\n    const loadCatalog = async (refresh: boolean = false) => {\r\n        if (typeof window === 'undefined') return;\r\n\r\n        setIsLoadingCatalog(true);\r\n        try {\r\n            const url = refresh ? '/api/recommendations?refresh=true' : '/api/recommendations';\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\r\n                console.error('Catalog fetch error:', response.status, errorData);\r\n                throw new Error(`Failed to fetch catalog: ${errorData.error || response.statusText}`);\r\n            }\r\n            const data = await response.json();\r\n            setCatalog(data);\r\n            if (data.products.length > 0) {\r\n                setSelectedProductId(data.products[0].id);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load catalog:', error);\r\n            // Show error to user instead of silent fail\r\n            alert(`Failed to load product catalog. Please check:\\n1. GEMINI_API_KEY is set in .env.local\\n2. Dev server is running\\n\\nError: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n        } finally {\r\n            setIsLoadingCatalog(false);\r\n        }\r\n    };\r\n\r\n    // Generate recommendations (Gemini-first)\r\n    const generateRecommendations = async () => {\r\n        if (!selectedProductId) return;\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await fetch('/api/recommendations', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    productId: selectedProductId,\r\n                    strategy: 'smart',\r\n                    useTensorFlowEnhancement: useTensorFlow\r\n                })\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Failed to generate recommendations');\r\n\r\n            const data = await response.json();\r\n            setResult(data);\r\n        } catch (error) {\r\n            console.error('Recommendation error:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Initial load - client-side only\r\n    // Use UseEffect to prevent multiple calls during render\r\n    useEffect(() => {\r\n        if (!catalog && mounted) {\r\n            loadCatalog();\r\n        }\r\n    }, [mounted]);\r\n\r\n    if (!mounted || !catalog) {\r\n        return (\r\n            <div className=\"flex-1 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"animate-pulse font-mono text-signal-cyan text-lg mb-2\">\r\n                        ≡ƒºá AI Engine Initializing...\r\n                    </div>\r\n                    <div className=\"text-xs text-text-tertiary\">\r\n                        Generating product catalog with AI\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n            {/* Header */}\r\n            <div className=\"hud-panel p-6 border-b border-border-default\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div>\r\n                        <h2 className=\"font-mono text-xl font-bold text-signal-cyan mb-1\">\r\n                            ≡ƒºá AI RECOMMENDATIONS\r\n                        </h2>\r\n                        <p className=\"text-sm text-text-secondary\">\r\n                            AI-Generated Catalog + Intelligent Product Recommendations\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"font-mono text-xs text-signal-green\">\r\n                            Γ£ô AI Engine: Active\r\n                        </div>\r\n                        {useTensorFlow && (\r\n                            <div className=\"font-mono text-xs text-signal-amber\">\r\n                                + TensorFlow: Enhanced\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Catalog Info */}\r\n                <div className=\"mb-4 p-3 bg-surface-elevated border border-border-default\">\r\n                    <div className=\"flex items-center justify-between text-xs font-mono\">\r\n                        <div className=\"flex gap-4\">\r\n                            <span className=\"text-text-tertiary\">\r\n                                Catalog: <span className=\"text-signal-cyan\">{catalog.totalProducts} products</span>\r\n                            </span>\r\n                            <span className=\"text-text-tertiary\">\r\n                                Value: <span className=\"text-signal-green\">Γé╣{catalog.totalValue.toLocaleString()}</span>\r\n                            </span>\r\n                            <span className=\"text-text-tertiary\">\r\n                                Generated: <span className=\"text-text-secondary\">{new Date(catalog.generatedAt).toLocaleTimeString()}</span>\r\n                            </span>\r\n                        </div>\r\n                        <button\r\n                            onClick={() => loadCatalog(true)}\r\n                            disabled={isLoadingCatalog}\r\n                            className=\"text-signal-cyan hover:text-signal-amber transition-colors disabled:opacity-50\"\r\n                        >\r\n                            {isLoadingCatalog ? 'Γƒ│ Regenerating...' : 'Γå╗ Refresh Catalog'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Controls */}\r\n                <div className=\"flex gap-4\">\r\n                    <select\r\n                        value={selectedProductId}\r\n                        onChange={(e) => setSelectedProductId(e.target.value)}\r\n                        className=\"flex-1 bg-surface-elevated border border-border-default px-4 py-2 font-mono text-sm text-text-primary\"\r\n                    >\r\n                        {catalog.products.map(product => (\r\n                            <option key={product.id} value={product.id}>\r\n                                {product.name} - Γé╣{product.price}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    <label className=\"flex items-center gap-2 px-4 bg-surface-elevated border border-border-default cursor-pointer hover:border-signal-amber transition-colors\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            checked={useTensorFlow}\r\n                            onChange={(e) => setUseTensorFlow(e.target.checked)}\r\n                            className=\"w-4 h-4\"\r\n                        />\r\n                        <span className=\"font-mono text-xs uppercase tracking-wider text-text-secondary\">\r\n                            + TensorFlow Enhancement\r\n                        </span>\r\n                    </label>\r\n\r\n                    <button\r\n                        onClick={generateRecommendations}\r\n                        disabled={isLoading}\r\n                        className=\"px-8 py-2 bg-signal-green text-surface-base font-mono text-sm font-bold uppercase tracking-wider hover:bg-opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {isLoading ? 'Analyzing...' : 'Generate'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Results */}\r\n            {result && (\r\n                <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\r\n                    {/* Target Product */}\r\n                    <div className=\"hud-panel p-4 border-l-4 border-signal-cyan\">\r\n                        <div className=\"font-mono text-xs uppercase tracking-wider text-text-tertiary mb-2\">\r\n                            Target Product\r\n                        </div>\r\n                        <h3 className=\"font-mono text-lg font-bold text-text-primary mb-1\">\r\n                            {result.targetProduct.name}\r\n                        </h3>\r\n                        <div className=\"flex items-center gap-4 text-sm text-text-secondary\">\r\n                            <span>{result.targetProduct.category}</span>\r\n                            <span>Γé╣{result.targetProduct.price}</span>\r\n                            <span className=\"text-signal-cyan\">\r\n                                Keywords: {result.targetProduct.keywords.join(', ')}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* AI Analysis Summary */}\r\n                    <div className=\"hud-panel p-6 border-l-4 border-signal-amber\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div className=\"font-mono text-sm uppercase tracking-wider text-signal-amber\">\r\n                                ≡ƒºá AI Analysis\r\n                            </div>\r\n                            <div className=\"flex gap-2 text-xs font-mono\">\r\n                                <span className=\"text-text-tertiary\">AI Confidence:</span>\r\n                                <span className=\"text-signal-green font-bold\">{result.confidence}%</span>\r\n                                {result.powered.tensorflow && (\r\n                                    <>\r\n                                        <span className=\"text-text-tertiary ml-3\">+ TF Enhanced</span>\r\n                                        <span className=\"text-signal-cyan\">Γ£ô</span>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-text-primary leading-relaxed mb-4\">\r\n                            {result.analysis.summary}\r\n                        </p>\r\n                        <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-border-default\">\r\n                            <div>\r\n                                <div className=\"text-xs text-text-tertiary mb-1\">Expected Revenue Increase</div>\r\n                                <div className=\"text-xl font-bold text-signal-green\">\r\n                                    {result.analysis.expectedImpact.revenueIncrease}\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"text-xs text-text-tertiary mb-1\">Conversion Boost</div>\r\n                                <div className=\"text-xl font-bold text-signal-green\">\r\n                                    {result.analysis.expectedImpact.conversionBoost}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Recommendations */}\r\n                    <div className=\"space-y-3\">\r\n                        <h3 className=\"font-mono text-sm uppercase tracking-wider text-text-tertiary\">\r\n                            Recommended Products ({result.recommendations.length})\r\n                        </h3>\r\n                        {result.recommendations.map((rec, idx) => (\r\n                            <div key={idx} className=\"hud-panel p-4 hover:border-signal-cyan transition-colors\">\r\n                                <div className=\"flex items-start justify-between mb-2\">\r\n                                    <div className=\"flex-1\">\r\n                                        <h4 className=\"font-mono font-bold text-text-primary mb-1\">\r\n                                            {rec.product.name}\r\n                                        </h4>\r\n                                        <p className=\"text-sm text-text-secondary mb-2\">\r\n                                            {rec.reason}\r\n                                        </p>\r\n                                        {rec.insights && rec.insights.length > 0 && (\r\n                                            <div className=\"mt-2 space-y-1\">\r\n                                                {rec.insights.map((insight, i) => (\r\n                                                    <div key={i} className=\"text-xs text-signal-cyan\">\r\n                                                        ΓÇó {insight}\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        )}\r\n                                        <div className=\"flex items-center gap-3 text-xs text-text-tertiary mt-2\">\r\n                                            <span>{rec.product.category}</span>\r\n                                            <span className=\"text-text-primary font-bold\">Γé╣{rec.product.price}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"ml-4 text-center\">\r\n                                        <div className=\"text-xs text-text-tertiary mb-1\">Match Score</div>\r\n                                        <div className={`text-2xl font-bold font-mono ${rec.score > 80 ? 'text-signal-green' :\r\n                                            rec.score > 60 ? 'text-signal-amber' :\r\n                                                'text-signal-cyan'\r\n                                            }`}>\r\n                                            {rec.score}%\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Insights */}\r\n                    {result.analysis.insights.length > 0 && (\r\n                        <div className=\"space-y-3\">\r\n                            <h3 className=\"font-mono text-sm uppercase tracking-wider text-text-tertiary\">\r\n                                Strategic Insights\r\n                            </h3>\r\n                            {result.analysis.insights.map((insight, idx) => (\r\n                                <div key={idx} className=\"hud-panel p-4 border-l-4 border-signal-green\">\r\n                                    <div className=\"flex items-start justify-between\">\r\n                                        <div className=\"flex-1\">\r\n                                            <div className=\"font-mono text-xs uppercase tracking-wider text-signal-green mb-1\">\r\n                                                {insight.type}\r\n                                            </div>\r\n                                            <h4 className=\"font-mono font-bold text-text-primary mb-1\">\r\n                                                {insight.title}\r\n                                            </h4>\r\n                                            <p className=\"text-sm text-text-secondary\">\r\n                                                {insight.description}\r\n                                            </p>\r\n                                        </div>\r\n                                        {insight.actionable && (\r\n                                            <div className=\"ml-3 text-signal-green text-xs font-mono\">\r\n                                                Γ£ô Actionable\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Bundle Opportunities */}\r\n                    {result.analysis.bundleOpportunities.length > 0 && (\r\n                        <div className=\"space-y-3\">\r\n                            <h3 className=\"font-mono text-sm uppercase tracking-wider text-text-tertiary\">\r\n                                Bundle Opportunities\r\n                            </h3>\r\n                            {result.analysis.bundleOpportunities.map((bundle, idx) => (\r\n                                <div key={idx} className=\"hud-panel p-4 border-l-4 border-signal-amber\">\r\n                                    <div className=\"flex items-start justify-between mb-3\">\r\n                                        <div>\r\n                                            <h4 className=\"font-mono font-bold text-text-primary mb-2\">\r\n                                                Bundle #{idx + 1}\r\n                                            </h4>\r\n                                            <div className=\"space-y-1 text-sm text-text-secondary\">\r\n                                                {bundle.products.map((prod, i) => (\r\n                                                    <div key={i}>ΓÇó {prod}</div>\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <div className=\"text-xs text-text-tertiary mb-1\">Bundle Price</div>\r\n                                            <div className=\"text-2xl font-bold text-signal-green\">\r\n                                                Γé╣{bundle.expectedValue}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-signal-amber mt-1\">\r\n                                                Save {bundle.discount}%\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <p className=\"text-sm text-text-secondary italic\">\r\n                                        {bundle.reason}\r\n                                    </p>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Powered By */}\r\n                    <div className=\"hud-panel p-3 flex items-center justify-center gap-4 text-xs font-mono text-text-tertiary\">\r\n                        <span>Powered by:</span>\r\n                        <span className=\"text-signal-amber\">≡ƒºá AI Engine (Primary)</span>\r\n                        {result.powered.tensorflow && (\r\n                            <span className=\"text-signal-cyan\">+ TensorFlow.js (Enhanced)</span>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Empty State */}\r\n            {!result && !isLoading && (\r\n                <div className=\"flex-1 flex items-center justify-center\">\r\n                    <div className=\"text-center max-w-md\">\r\n                        <div className=\"text-6xl mb-4\">≡ƒºá</div>\r\n                        <h3 className=\"font-mono text-lg font-bold text-text-primary mb-2\">\r\n                            AI Powered Recommendations\r\n                        </h3>\r\n                        <p className=\"text-sm text-text-secondary mb-6\">\r\n                            Select a product and click \"Generate\" to see AI-powered intelligent recommendations with strategic insights.\r\n                        </p>\r\n                        <div className=\"space-y-2 text-xs text-text-tertiary text-left bg-surface-elevated p-4 border border-border-default\">\r\n                            <div>Γ£ô AI catalog generation</div>\r\n                            <div>Γ£ô Deep context understanding</div>\r\n                            <div>Γ£ô Strategic business insights</div>\r\n                            <div>Γ£ô Bundle optimization with code execution</div>\r\n                            <div>Γ£ô Optional TensorFlow similarity enhancement</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\components\\simulation\\BeastModePanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SimulationResult' is defined but never used.","line":6,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":49,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SimulationResult"},"fix":{"range":[227,245],"text":""},"desc":"Remove unused variable \"SimulationResult\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useSimulationResult, useSellerOpsStore } from '@/lib/store';\r\nimport { quickPriceImpact } from '@/lib/simulation/engine';\r\nimport type { SimulationParams, SimulationResult, SeverityLevel } from '@/lib/types';\r\n\r\n// === SLIDER COMPONENT ===\r\ninterface SliderProps {\r\n    label: string;\r\n    value: number;\r\n    min: number;\r\n    max: number;\r\n    step?: number;\r\n    unit?: string;\r\n    onChange: (value: number) => void;\r\n}\r\n\r\nfunction Slider({ label, value, min, max, step = 1, unit = '%', onChange }: SliderProps) {\r\n    const percentage = ((value - min) / (max - min)) * 100;\r\n\r\n    return (\r\n        <div className=\"space-y-2\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <span className=\"font-mono text-xs uppercase tracking-wider text-text-tertiary\">\r\n                    {label}\r\n                </span>\r\n                <span className={`font-mono text-sm font-bold ${value > 0 ? 'text-signal-green' : value < 0 ? 'text-signal-red' : 'text-text-primary'\r\n                    }`}>\r\n                    {value > 0 ? '+' : ''}{value}{unit}\r\n                </span>\r\n            </div>\r\n            <div className=\"relative h-2 bg-surface-overlay\">\r\n                <div\r\n                    className={`absolute h-full ${value >= 0 ? 'bg-signal-green' : 'bg-signal-red'}`}\r\n                    style={{\r\n                        width: `${Math.abs(percentage - 50) * 2}%`,\r\n                        left: value >= 0 ? '50%' : `${percentage}%`,\r\n                        right: value >= 0 ? `${100 - percentage}%` : '50%',\r\n                    }}\r\n                />\r\n                <div\r\n                    className=\"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-text-primary border-2 border-surface-base\"\r\n                    style={{ left: `calc(${percentage}% - 8px)` }}\r\n                />\r\n                <input\r\n                    type=\"range\"\r\n                    min={min}\r\n                    max={max}\r\n                    step={step}\r\n                    value={value}\r\n                    onChange={(e) => onChange(Number(e.target.value))}\r\n                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// === RESULT CARD ===\r\ninterface ResultCardProps {\r\n    label: string;\r\n    value: string | number;\r\n    subtext?: string;\r\n    severity?: SeverityLevel;\r\n}\r\n\r\nfunction ResultCard({ label, value, subtext, severity = 'INFO' }: ResultCardProps) {\r\n    const getSeverityClass = () => {\r\n        switch (severity) {\r\n            case 'CRITICAL': return 'border-signal-red text-signal-red';\r\n            case 'WARNING': return 'border-signal-amber text-signal-amber';\r\n            case 'OK': return 'border-signal-green text-signal-green';\r\n            default: return 'border-signal-cyan text-signal-cyan';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`hud-panel p-4 border-l-4 ${getSeverityClass()}`}>\r\n            <span className=\"font-mono text-xs uppercase tracking-wider text-text-tertiary block mb-1\">\r\n                {label}\r\n            </span>\r\n            <span className=\"font-mono text-2xl font-bold block\">\r\n                {value}\r\n            </span>\r\n            {subtext && (\r\n                <span className=\"font-mono text-xs text-text-secondary\">\r\n                    {subtext}\r\n                </span>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// === BEAST MODE PANEL ===\r\nexport function BeastModePanel() {\r\n    const [params, setParams] = useState<SimulationParams>({\r\n        priceChange: 0,\r\n        adSpendChange: 0,\r\n        shippingSpeedChange: 0,\r\n    });\r\n\r\n    const [localResult, setLocalResult] = useState<{\r\n        revenueChange: string;\r\n        marginChange: string;\r\n        competitorRisk: string;\r\n    } | null>(null);\r\n\r\n    const simulationResult = useSimulationResult();\r\n    const runSimulation = useSellerOpsStore((s) => s.runSimulation);\r\n    const isSimulating = useSellerOpsStore((s) => s.isSimulating);\r\n\r\n    // Real-time preview as sliders move\r\n    const handleParamChange = useCallback((\r\n        key: keyof SimulationParams,\r\n        value: number\r\n    ) => {\r\n        const newParams = { ...params, [key]: value };\r\n        setParams(newParams);\r\n\r\n        // Quick local calculation for instant feedback\r\n        const quick = quickPriceImpact(newParams.priceChange);\r\n        setLocalResult(quick);\r\n    }, [params]);\r\n\r\n    // Full simulation on button click\r\n    const handleSimulate = useCallback(async () => {\r\n        await runSimulation(params);\r\n    }, [params, runSimulation]);\r\n\r\n    const displayResult = simulationResult ?? {\r\n        projectedRevenue: 50000,\r\n        projectedMargin: 22,\r\n        projectedVolume: 500,\r\n        competitorResponseProbability: 0,\r\n        riskLevel: 'OK' as SeverityLevel,\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex-1 p-6 bg-surface-base\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-3 mb-6\">\r\n                <div className=\"w-10 h-10 bg-signal-amber flex items-center justify-center\">\r\n                    <span className=\"font-mono font-bold text-black text-xl\">ΓÜö</span>\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"font-mono text-xl font-bold text-text-primary\">\r\n                        BEAST MODE\r\n                    </h2>\r\n                    <p className=\"font-mono text-xs text-text-tertiary uppercase tracking-wider\">\r\n                        Simulation & Counter-Strategy\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-6\">\r\n                {/* Left: Controls */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"hud-panel p-4\">\r\n                        <h3 className=\"font-mono text-sm font-bold text-text-primary mb-4 uppercase tracking-wider\">\r\n                            Adjust Parameters\r\n                        </h3>\r\n\r\n                        <div className=\"space-y-6\">\r\n                            <Slider\r\n                                label=\"Price Change\"\r\n                                value={params.priceChange}\r\n                                min={-20}\r\n                                max={20}\r\n                                onChange={(v) => handleParamChange('priceChange', v)}\r\n                            />\r\n\r\n                            <Slider\r\n                                label=\"Ad Spend Change\"\r\n                                value={params.adSpendChange}\r\n                                min={-50}\r\n                                max={100}\r\n                                step={5}\r\n                                onChange={(v) => handleParamChange('adSpendChange', v)}\r\n                            />\r\n\r\n                            <Slider\r\n                                label=\"Shipping Speed\"\r\n                                value={params.shippingSpeedChange}\r\n                                min={-3}\r\n                                max={3}\r\n                                unit=\" days\"\r\n                                onChange={(v) => handleParamChange('shippingSpeedChange', v)}\r\n                            />\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handleSimulate}\r\n                            disabled={isSimulating}\r\n                            className={`\r\n                w-full mt-6 py-3 px-4 font-mono text-sm font-bold uppercase tracking-wider\r\n                transition-all duration-200\r\n                ${isSimulating\r\n                                    ? 'bg-surface-overlay text-text-tertiary cursor-wait'\r\n                                    : 'bg-signal-amber text-black hover:bg-signal-green'\r\n                                }\r\n              `}\r\n                        >\r\n                            {isSimulating ? 'Simulating...' : 'Run Full Simulation'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Quick Preview */}\r\n                    {localResult && (\r\n                        <div className=\"hud-panel p-4\">\r\n                            <h3 className=\"font-mono text-xs text-text-tertiary uppercase tracking-wider mb-3\">\r\n                                Quick Preview\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-3 gap-2 text-center\">\r\n                                <div>\r\n                                    <span className=\"font-mono text-lg font-bold text-signal-cyan block\">\r\n                                        {localResult.revenueChange}\r\n                                    </span>\r\n                                    <span className=\"font-mono text-xs text-text-tertiary\">Revenue</span>\r\n                                </div>\r\n                                <div>\r\n                                    <span className=\"font-mono text-lg font-bold text-signal-amber block\">\r\n                                        {localResult.marginChange}\r\n                                    </span>\r\n                                    <span className=\"font-mono text-xs text-text-tertiary\">Margin</span>\r\n                                </div>\r\n                                <div>\r\n                                    <span className=\"font-mono text-lg font-bold text-signal-red block\">\r\n                                        {localResult.competitorRisk}\r\n                                    </span>\r\n                                    <span className=\"font-mono text-xs text-text-tertiary\">Comp. Risk</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Right: Results */}\r\n                <div className=\"space-y-4\">\r\n                    <h3 className=\"font-mono text-sm font-bold text-text-primary uppercase tracking-wider\">\r\n                        Projected Outcomes\r\n                    </h3>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <ResultCard\r\n                            label=\"Projected Revenue\"\r\n                            value={`Γé╣${displayResult.projectedRevenue.toLocaleString()}`}\r\n                            subtext=\"per day\"\r\n                            severity={displayResult.projectedRevenue > 50000 ? 'OK' : 'WARNING'}\r\n                        />\r\n                        <ResultCard\r\n                            label=\"Projected Margin\"\r\n                            value={`${displayResult.projectedMargin}%`}\r\n                            subtext=\"net margin\"\r\n                            severity={displayResult.projectedMargin > 20 ? 'OK' : displayResult.projectedMargin > 10 ? 'WARNING' : 'CRITICAL'}\r\n                        />\r\n                        <ResultCard\r\n                            label=\"Volume\"\r\n                            value={displayResult.projectedVolume}\r\n                            subtext=\"units/day\"\r\n                            severity=\"INFO\"\r\n                        />\r\n                        <ResultCard\r\n                            label=\"Competitor Response\"\r\n                            value={`${displayResult.competitorResponseProbability}%`}\r\n                            subtext=\"probability\"\r\n                            severity={\r\n                                displayResult.competitorResponseProbability > 60 ? 'CRITICAL' :\r\n                                    displayResult.competitorResponseProbability > 30 ? 'WARNING' : 'OK'\r\n                            }\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Risk Assessment */}\r\n                    <div className={`\r\n            hud-panel p-4 mt-4\r\n            ${displayResult.riskLevel === 'CRITICAL' ? 'border-signal-red' :\r\n                            displayResult.riskLevel === 'WARNING' ? 'border-signal-amber' :\r\n                                'border-signal-green'}\r\n          `}>\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <span className=\"font-mono text-sm text-text-tertiary\">Overall Risk</span>\r\n                            <span className={`\r\n                font-mono text-lg font-bold px-3 py-1\r\n                ${displayResult.riskLevel === 'CRITICAL' ? 'signal-critical' :\r\n                                    displayResult.riskLevel === 'WARNING' ? 'signal-warning' :\r\n                                        'signal-ok'}\r\n              `}>\r\n                                {displayResult.riskLevel}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\chart-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getRecentSignals' is defined but never used.","line":7,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":65,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getRecentSignals"},"fix":{"range":[202,220],"text":""},"desc":"Remove unused variable \"getRecentSignals\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deserializeSignal' is defined but never used.","line":12,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"deserializeSignal"},"fix":{"range":[428,452],"text":""},"desc":"Remove unused variable \"deserializeSignal\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[847,850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[847,850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1590,1593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1590,1593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":55,"column":23,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":55,"endColumn":56}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * SellerOps Data Service\r\n * Unified data access layer for War Room intelligence.\r\n * Abstracts Redis (Hot Storage) and Turso (Cold Storage).\r\n */\r\n\r\nimport { publishSignal as publishSignalToRedis, getRecentSignals, updateLiveStatus, getCachedLiveStatus } from './redis/unified-client';\r\nimport { saveThreat, getRecentThreats, saveSignal } from './turso/database';\r\nimport {\r\n    createSignal,\r\n    detectThreatsFromSignal,\r\n    deserializeSignal,\r\n    serializeSignal,\r\n    generateMockSignal\r\n} from './redis/signals';\r\nimport type { LiveStatus, Signal, ThreatEvent, SignalType } from './types';\r\n\r\n// === SIGNAL INGESTION ===\r\n\r\n/**\r\n * Ingest a raw signal, checking for threats and persisting to storage.\r\n * This is the \"Brain\" of the backend processing.\r\n */\r\nexport async function ingestSignal(type: SignalType, value: number, meta?: any): Promise<{ signal: Signal, threat: ThreatEvent | null }> {\r\n    // 1. Create standardized signal\r\n    const signal = createSignal(type, value, meta);\r\n\r\n    // 2. Hot Path: Publish to Redis for real-time feed\r\n    const serialized = serializeSignal(signal);\r\n    await publishSignalToRedis(serialized);\r\n\r\n    // 3. Cold Path: Persist to DB for audit\r\n    // (Fire and forget to not block response)\r\n    saveSignal(signal).catch(err => console.error('Failed to audit signal:', err));\r\n\r\n    // 4. Intelligence: Detect Threats\r\n    const detection = detectThreatsFromSignal(signal);\r\n    let threat: ThreatEvent | null = null;\r\n\r\n    if (detection && detection.shouldAlert) {\r\n        threat = {\r\n            id: `threat-${Date.now()}` as any,\r\n            severity: detection.severity,\r\n            title: `${type.replace(/_/g, ' ')} Detected`,\r\n            description: detection.message,\r\n            signals: [signal.id],\r\n            detectedAt: new Date(),\r\n            confidence: 100, // Deterministic rule = 100% confidence\r\n        };\r\n\r\n        // Persist threat\r\n        await saveThreat(threat);\r\n\r\n        // Also publish threat to Redis (channel: threats)\r\n        const redis = require('./redis/unified-client');\r\n        await redis.publishSignal(JSON.stringify(threat));\r\n    }\r\n\r\n    return { signal, threat };\r\n}\r\n\r\n// === LIVE FEED DATA ===\r\n\r\nexport async function getDashboardData() {\r\n    // 1. Get cached live status (or generate default if missing/stale)\r\n    const liveStatusStr = await getCachedLiveStatus();\r\n    let liveStatus: LiveStatus;\r\n\r\n    if (liveStatusStr) {\r\n        liveStatus = JSON.parse(liveStatusStr);\r\n        liveStatus.lastUpdated = new Date(liveStatus.lastUpdated);\r\n    } else {\r\n        // Generate fresh baseline status\r\n        liveStatus = {\r\n            revenueVelocity: 2800 + Math.random() * 400,\r\n            revenueDirection: Math.random() > 0.5 ? 'UP' : 'DOWN',\r\n            riskScore: Math.floor(Math.random() * 30 + 20),\r\n            opportunityScore: Math.floor(Math.random() * 40 + 40),\r\n            activeThreats: 0,\r\n            lastUpdated: new Date()\r\n        };\r\n        await updateLiveStatus(JSON.stringify(liveStatus));\r\n    }\r\n\r\n    // 2. Get recent threats from DB (Single Source of Truth)\r\n    let threats = await getRecentThreats(10);\r\n\r\n    // SEEDING: If no threats exist, generate a few for the \"War Room\" experience\r\n    if (threats.length === 0) {\r\n        // Run a few demo cycles to populate DB\r\n        await runDemoCycle();\r\n        await runDemoCycle();\r\n        threats = await getRecentThreats(10);\r\n    }\r\n\r\n    liveStatus.activeThreats = threats.filter(t => t.severity === 'CRITICAL' || t.severity === 'WARNING').length;\r\n\r\n    return {\r\n        status: liveStatus,\r\n        threats,\r\n    };\r\n}\r\n\r\n// === DEMO GENERATOR ===\r\nexport async function runDemoCycle() {\r\n    const signal = generateMockSignal();\r\n    return await ingestSignal(signal.type, signal.value, { previousValue: signal.previousValue });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\gemini\\attribution.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeAll' is defined but never used.","line":6,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":41,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"beforeAll"},"fix":{"range":[142,153],"text":""},"desc":"Remove unused variable \"beforeAll\"."}]},{"ruleId":"@next/next/no-assign-module-variable","severity":2,"message":"Do not assign to the variable `module`. See: https://nextjs.org/docs/messages/no-assign-module-variable","line":129,"column":9,"nodeType":"VariableDeclaration","endLine":129,"endColumn":65}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Gemini Attribution Core Integration Tests\r\n * These tests require a valid GEMINI_API_KEY in .env\r\n */\r\n\r\nimport { describe, it, expect, beforeAll } from 'vitest';\r\nimport { generateAttributionBrief } from '@/lib/gemini/attribution';\r\nimport type { ThreatEvent, Signal, ThreatId, SignalId } from '@/lib/types';\r\n\r\n// Skip tests if no API key (for CI environments)\r\nconst hasApiKey = !!process.env.GEMINI_API_KEY;\r\n\r\ndescribe.skipIf(!hasApiKey)('Gemini Attribution Core - Integration', () => {\r\n\r\n    // Test data\r\n    const mockThreat: ThreatEvent = {\r\n        id: 'test-threat-1' as ThreatId,\r\n        severity: 'CRITICAL',\r\n        title: 'Buy Box Lost - SKU #334',\r\n        description: 'Competitor undercut price by Γé╣120. Current price Γé╣1,499 vs competitor Γé╣1,379.',\r\n        signals: ['sig-1', 'sig-2'] as SignalId[],\r\n        detectedAt: new Date(),\r\n        suggestedAction: 'Match price to regain Buy Box',\r\n        confidence: 94,\r\n    };\r\n\r\n    const mockSignals: Signal[] = [\r\n        {\r\n            id: 'sig-1' as SignalId,\r\n            type: 'COMPETITOR_PRICE',\r\n            timestamp: new Date(Date.now() - 3600000),\r\n            value: 1379,\r\n            previousValue: 1499,\r\n            delta: -120,\r\n        },\r\n        {\r\n            id: 'sig-2' as SignalId,\r\n            type: 'CONVERSION_DROP',\r\n            timestamp: new Date(Date.now() - 1800000),\r\n            value: 2.1,\r\n            previousValue: 3.8,\r\n            delta: -1.7,\r\n        },\r\n        {\r\n            id: 'sig-3' as SignalId,\r\n            type: 'SEARCH_DROP',\r\n            timestamp: new Date(Date.now() - 900000),\r\n            value: 45,\r\n            previousValue: 78,\r\n            delta: -33,\r\n        },\r\n    ];\r\n\r\n    it('should generate an attribution brief from Gemini', async () => {\r\n        const brief = await generateAttributionBrief(mockThreat, mockSignals);\r\n\r\n        // Verify structure\r\n        expect(brief).toBeDefined();\r\n        expect(brief.threatId).toBe(mockThreat.id);\r\n        expect(brief.summary).toBeTruthy();\r\n        expect(brief.summary.length).toBeGreaterThan(50);\r\n        expect(brief.causes).toBeInstanceOf(Array);\r\n        expect(brief.suggestedActions).toBeInstanceOf(Array);\r\n        expect(brief.confidence).toBeGreaterThanOrEqual(0);\r\n        expect(brief.confidence).toBeLessThanOrEqual(100);\r\n        expect(brief.generatedAt).toBeInstanceOf(Date);\r\n    }, 30000); // 30s timeout for API call\r\n\r\n    it('should include causal factors', async () => {\r\n        const brief = await generateAttributionBrief(mockThreat, mockSignals);\r\n\r\n        expect(brief.causes.length).toBeGreaterThan(0);\r\n\r\n        for (const cause of brief.causes) {\r\n            expect(cause.factor).toBeTruthy();\r\n            expect(['HIGH', 'MEDIUM', 'LOW']).toContain(cause.impact);\r\n            expect(cause.evidence).toBeTruthy();\r\n        }\r\n    }, 30000);\r\n\r\n    it('should include suggested actions', async () => {\r\n        const brief = await generateAttributionBrief(mockThreat, mockSignals);\r\n\r\n        expect(brief.suggestedActions.length).toBeGreaterThan(0);\r\n\r\n        for (const action of brief.suggestedActions) {\r\n            expect(action.action).toBeTruthy();\r\n            expect(['IMMEDIATE', 'SOON', 'OPTIONAL']).toContain(action.priority);\r\n            expect(action.expectedOutcome).toBeTruthy();\r\n        }\r\n    }, 30000);\r\n\r\n    it('should reference signals in evidence', async () => {\r\n        const brief = await generateAttributionBrief(mockThreat, mockSignals);\r\n\r\n        // At least one cause should reference the data from signals\r\n        const allEvidence = brief.causes.map(c => c.evidence.toLowerCase()).join(' ');\r\n        const allSummary = brief.summary.toLowerCase();\r\n\r\n        // Should mention price, conversion, or competitor somewhere\r\n        const relevantTerms = ['price', 'competitor', 'conversion', 'drop', 'decrease'];\r\n        const hasRelevantTerm = relevantTerms.some(\r\n            term => allEvidence.includes(term) || allSummary.includes(term)\r\n        );\r\n\r\n        expect(hasRelevantTerm).toBe(true);\r\n    }, 30000);\r\n\r\n    it('should handle minimal signals gracefully', async () => {\r\n        const minimalSignals: Signal[] = [\r\n            {\r\n                id: 'sig-minimal' as SignalId,\r\n                type: 'PRICE_CHANGE',\r\n                timestamp: new Date(),\r\n                value: 100,\r\n            },\r\n        ];\r\n\r\n        const brief = await generateAttributionBrief(mockThreat, minimalSignals);\r\n\r\n        expect(brief).toBeDefined();\r\n        expect(brief.summary).toBeTruthy();\r\n    }, 30000);\r\n});\r\n\r\n// Basic unit tests that don't require API\r\ndescribe('Gemini Attribution Core - Unit', () => {\r\n    it('should have the module exports', async () => {\r\n        const module = await import('@/lib/gemini/attribution');\r\n\r\n        expect(module.generateAttributionBrief).toBeDefined();\r\n        expect(typeof module.generateAttributionBrief).toBe('function');\r\n        expect(module.streamAttributionBrief).toBeDefined();\r\n        expect(typeof module.streamAttributionBrief).toBe('function');\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\gemini\\attribution.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\gemini\\catalog-generator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCodeExecution' is assigned a value but never used.","line":205,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6961,6964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6961,6964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14711,14714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14711,14714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":436,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":436,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15418,15421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15418,15421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Gemini AI Product Catalog Generator\r\n * Dynamically generates product catalogs based on business context\r\n * PRIMARY AI engine for SellerOps product intelligence\r\n */\r\n\r\nimport { GoogleGenAI } from '@google/genai';\r\n\r\n// === MODELS ===\r\nconst PRIMARY_MODEL = 'gemini-2.5-flash-lite';\r\nconst FALLBACK_MODEL = 'gemini-2.5-flash-lite';\r\n\r\n// === TYPES ===\r\nexport interface Product {\r\n    id: string;\r\n    name: string;\r\n    category: string;\r\n    price: number;\r\n    keywords: string[];\r\n    description: string;\r\n    specifications?: Record<string, string>;\r\n    targetAudience?: string[];\r\n    seasonality?: 'ALL_YEAR' | 'SEASONAL' | 'TRENDING';\r\n}\r\n\r\nexport interface ProductCatalog {\r\n    products: Product[];\r\n    categories: string[];\r\n    totalValue: number;\r\n    generatedAt: Date;\r\n    context: string;\r\n}\r\n\r\nexport interface RecommendationRequest {\r\n    productId: string;\r\n    context?: string;\r\n    customerProfile?: {\r\n        purchaseHistory?: string[];\r\n        budget?: number;\r\n        preferences?: string[];\r\n    };\r\n    strategy?: 'cross-sell' | 'upsell' | 'bundle' | 'smart';\r\n}\r\n\r\nexport interface GeminiRecommendation {\r\n    product: Product;\r\n    score: number;\r\n    reason: string;\r\n    insights: string[];\r\n    bundleCompatibility?: number;\r\n}\r\n\r\nexport interface RecommendationResult {\r\n    recommendations: GeminiRecommendation[];\r\n    strategy: string;\r\n    confidence: number;\r\n    analysis: {\r\n        summary: string;\r\n        insights: Array<{\r\n            type: 'CROSS_SELL' | 'UPSELL' | 'BUNDLE' | 'TRENDING';\r\n            title: string;\r\n            description: string;\r\n            actionable: boolean;\r\n        }>;\r\n        bundleOpportunities: Array<{\r\n            products: string[];\r\n            discount: number;\r\n            expectedValue: number;\r\n            reason: string;\r\n        }>;\r\n        pricingStrategy: string;\r\n        expectedImpact: {\r\n            revenueIncrease: string;\r\n            conversionBoost: string;\r\n        };\r\n    };\r\n    tensorFlowEnhanced?: boolean; // Optional TF enhancement flag\r\n}\r\n\r\n// === JSON SCHEMAS ===\r\nconst ProductSchema = {\r\n    type: 'object',\r\n    properties: {\r\n        id: { type: 'string' },\r\n        name: { type: 'string' },\r\n        category: { type: 'string' },\r\n        price: { type: 'number' },\r\n        keywords: { type: 'array', items: { type: 'string' } },\r\n        description: { type: 'string' },\r\n        targetAudience: { type: 'array', items: { type: 'string' } },\r\n        seasonality: {\r\n            type: 'string',\r\n            enum: ['ALL_YEAR', 'SEASONAL', 'TRENDING']\r\n        }\r\n    },\r\n    required: ['id', 'name', 'category', 'price', 'keywords', 'description']\r\n};\r\n\r\nconst CatalogSchema = {\r\n    type: 'object',\r\n    properties: {\r\n        products: {\r\n            type: 'array',\r\n            items: ProductSchema\r\n        },\r\n        categories: {\r\n            type: 'array',\r\n            items: { type: 'string' }\r\n        }\r\n    },\r\n    required: ['products', 'categories']\r\n};\r\n\r\nconst RecommendationSchema = {\r\n    type: 'object',\r\n    properties: {\r\n        recommendations: {\r\n            type: 'array',\r\n            items: {\r\n                type: 'object',\r\n                properties: {\r\n                    productId: { type: 'string' },\r\n                    score: { type: 'number', minimum: 0, maximum: 100 },\r\n                    reason: { type: 'string' },\r\n                    insights: { type: 'array', items: { type: 'string' } },\r\n                    bundleCompatibility: { type: 'number', minimum: 0, maximum: 100 }\r\n                },\r\n                required: ['productId', 'score', 'reason', 'insights']\r\n            }\r\n        },\r\n        strategy: { type: 'string' },\r\n        confidence: { type: 'number', minimum: 0, maximum: 100 },\r\n        analysis: {\r\n            type: 'object',\r\n            properties: {\r\n                summary: { type: 'string' },\r\n                insights: {\r\n                    type: 'array',\r\n                    items: {\r\n                        type: 'object',\r\n                        properties: {\r\n                            type: {\r\n                                type: 'string',\r\n                                enum: ['CROSS_SELL', 'UPSELL', 'BUNDLE', 'TRENDING']\r\n                            },\r\n                            title: { type: 'string' },\r\n                            description: { type: 'string' },\r\n                            actionable: { type: 'boolean' }\r\n                        },\r\n                        required: ['type', 'title', 'description', 'actionable']\r\n                    }\r\n                },\r\n                bundleOpportunities: {\r\n                    type: 'array',\r\n                    items: {\r\n                        type: 'object',\r\n                        properties: {\r\n                            products: { type: 'array', items: { type: 'string' } },\r\n                            discount: { type: 'number' },\r\n                            expectedValue: { type: 'number' },\r\n                            reason: { type: 'string' }\r\n                        },\r\n                        required: ['products', 'discount', 'expectedValue', 'reason']\r\n                    }\r\n                },\r\n                pricingStrategy: { type: 'string' },\r\n                expectedImpact: {\r\n                    type: 'object',\r\n                    properties: {\r\n                        revenueIncrease: { type: 'string' },\r\n                        conversionBoost: { type: 'string' }\r\n                    },\r\n                    required: ['revenueIncrease', 'conversionBoost']\r\n                }\r\n            },\r\n            required: ['summary', 'insights', 'bundleOpportunities', 'pricingStrategy', 'expectedImpact']\r\n        }\r\n    },\r\n    required: ['recommendations', 'strategy', 'confidence', 'analysis']\r\n};\r\n\r\n// === GEMINI CLIENT ===\r\nlet aiClient: GoogleGenAI | null = null;\r\n\r\nfunction getGeminiClient(): GoogleGenAI {\r\n    if (!aiClient) {\r\n        const apiKey = process.env.GEMINI_API_KEY;\r\n        if (!apiKey) {\r\n            throw new Error('GEMINI_API_KEY environment variable is not set');\r\n        }\r\n        aiClient = new GoogleGenAI({ apiKey });\r\n    }\r\n    return aiClient;\r\n}\r\n\r\n// === CATALOG GENERATION ===\r\n\r\n/**\r\n * Generate a product catalog using Gemini AI\r\n * Can be customized for different business domains\r\n */\r\nexport async function generateProductCatalog(\r\n    businessContext: string = 'electronics and accessories e-commerce',\r\n    productCount: number = 10,\r\n    useCodeExecution: boolean = true\r\n): Promise<ProductCatalog> {\r\n    const client = getGeminiClient();\r\n\r\n    const prompt = `You are a product catalog generator for a ${businessContext} business.\r\n\r\nGenerate ${productCount} realistic products with pricing, keywords, and descriptions.\r\nReturn structured JSON matching the schema.`;\r\n\r\n    // Note: codeExecution tool cannot be used with structured JSON output\r\n    const config: any = {\r\n        responseMimeType: 'application/json',\r\n        responseJsonSchema: CatalogSchema,\r\n    };\r\n\r\n    try {\r\n        const response = await client.models.generateContent({\r\n            model: PRIMARY_MODEL,\r\n            contents: prompt,\r\n            config\r\n        });\r\n\r\n        const responseText = response.text || '{}';\r\n        const catalogData = JSON.parse(responseText);\r\n\r\n        return {\r\n            products: catalogData.products,\r\n            categories: catalogData.categories,\r\n            totalValue: catalogData.products.reduce((sum: number, p: Product) => sum + p.price, 0),\r\n            generatedAt: new Date(),\r\n            context: businessContext\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error('Gemini catalog generation error:', error);\r\n\r\n        // Fallback to simpler model\r\n        try {\r\n            const fallbackResponse = await client.models.generateContent({\r\n                model: FALLBACK_MODEL,\r\n                contents: prompt,\r\n                config: {\r\n                    responseMimeType: 'application/json',\r\n                    responseJsonSchema: CatalogSchema,\r\n                }\r\n            });\r\n\r\n            const responseText = fallbackResponse.text || '{}';\r\n            const catalogData = JSON.parse(responseText);\r\n\r\n            return {\r\n                products: catalogData.products,\r\n                categories: catalogData.categories,\r\n                totalValue: catalogData.products.reduce((sum: number, p: Product) => sum + p.price, 0),\r\n                generatedAt: new Date(),\r\n                context: businessContext\r\n            };\r\n        } catch (fallbackError) {\r\n            console.error('Fallback model also failed:', fallbackError);\r\n\r\n            // Ultimate fallback: Return static demo catalog when quota exhausted\r\n            console.warn('ΓÜá∩╕Å Using static demo catalog due to API quota limits');\r\n            return getStaticDemoCatalog(businessContext);\r\n        }\r\n    }\r\n}\r\n\r\n// === STATIC DEMO CATALOG (Fallback for rate limits) ===\r\nfunction getStaticDemoCatalog(businessContext: string): ProductCatalog {\r\n    const products: Product[] = [\r\n        {\r\n            id: 'PROD-001',\r\n            name: 'Premium Wireless Headphones',\r\n            category: 'Electronics',\r\n            price: 2499,\r\n            keywords: ['wireless', 'bluetooth', 'audio', 'noise-cancelling'],\r\n            description: 'High-quality wireless headphones with active noise cancellation',\r\n            targetAudience: ['professionals', 'students', 'music lovers'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-002',\r\n            name: 'Laptop Stand Aluminum',\r\n            category: 'Accessories',\r\n            price: 899,\r\n            keywords: ['laptop', 'ergonomic', 'desk', 'aluminum'],\r\n            description: 'Ergonomic laptop stand for better posture',\r\n            targetAudience: ['remote workers', 'students'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-003',\r\n            name: 'USB-C Hub Multi-Port',\r\n            category: 'Electronics',\r\n            price: 1299,\r\n            keywords: ['usb-c', 'hub', 'adapter', 'ports'],\r\n            description: '7-in-1 USB-C hub with HDMI, USB 3.0, and card readers',\r\n            targetAudience: ['professionals', 'digital nomads'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-004',\r\n            name: 'Mechanical Keyboard RGB',\r\n            category: 'Electronics',\r\n            price: 3499,\r\n            keywords: ['keyboard', 'mechanical', 'rgb', 'gaming'],\r\n            description: 'Mechanical gaming keyboard with RGB backlighting',\r\n            targetAudience: ['gamers', 'programmers'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-005',\r\n            name: 'Portable SSD 1TB',\r\n            category: 'Storage',\r\n            price: 4999,\r\n            keywords: ['ssd', 'storage', 'portable', 'backup'],\r\n            description: 'Fast portable SSD with 1TB capacity',\r\n            targetAudience: ['content creators', 'professionals'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-006',\r\n            name: 'Webcam 1080p HD',\r\n            category: 'Electronics',\r\n            price: 1899,\r\n            keywords: ['webcam', 'video', 'streaming', 'meetings'],\r\n            description: 'Full HD webcam for video calls and streaming',\r\n            targetAudience: ['remote workers', 'streamers'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-007',\r\n            name: 'Phone Stand Adjustable',\r\n            category: 'Accessories',\r\n            price: 399,\r\n            keywords: ['phone', 'stand', 'holder', 'desk'],\r\n            description: 'Adjustable phone stand for desk or nightstand',\r\n            targetAudience: ['everyone'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-008',\r\n            name: 'Wireless Mouse Ergonomic',\r\n            category: 'Electronics',\r\n            price: 799,\r\n            keywords: ['mouse', 'wireless', 'ergonomic', 'bluetooth'],\r\n            description: 'Ergonomic wireless mouse with precision tracking',\r\n            targetAudience: ['professionals', 'students'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-009',\r\n            name: 'Cable Management Kit',\r\n            category: 'Accessories',\r\n            price: 299,\r\n            keywords: ['cables', 'organizer', 'desk', 'management'],\r\n            description: 'Complete cable management solution for clean desk setup',\r\n            targetAudience: ['everyone'],\r\n            seasonality: 'ALL_YEAR'\r\n        },\r\n        {\r\n            id: 'PROD-010',\r\n            name: 'Desk Lamp LED Smart',\r\n            category: 'Accessories',\r\n            price: 1599,\r\n            keywords: ['lamp', 'led', 'desk', 'smart', 'adjustable'],\r\n            description: 'Smart LED desk lamp with adjustable brightness and color',\r\n            targetAudience: ['students', 'professionals'],\r\n            seasonality: 'ALL_YEAR'\r\n        }\r\n    ];\r\n\r\n    return {\r\n        products,\r\n        categories: ['Electronics', 'Accessories', 'Storage'],\r\n        totalValue: products.reduce((sum, p) => sum + p.price, 0),\r\n        generatedAt: new Date(),\r\n        context: `${businessContext} (demo mode - API quota reached)`\r\n    };\r\n}\r\n\r\n// === SMART RECOMMENDATIONS ===\r\n\r\n/**\r\n * Generate intelligent product recommendations using Gemini AI\r\n * PRIMARY recommendation engine - uses deep context understanding\r\n */\r\nexport async function generateSmartRecommendations(\r\n    request: RecommendationRequest,\r\n    catalog: Product[]\r\n): Promise<RecommendationResult> {\r\n    const client = getGeminiClient();\r\n\r\n    const targetProduct = catalog.find(p => p.id === request.productId);\r\n    if (!targetProduct) {\r\n        throw new Error(`Product ${request.productId} not found in catalog`);\r\n    }\r\n\r\n    const prompt = buildRecommendationPrompt(targetProduct, catalog, request);\r\n\r\n    try {\r\n        // Note: codeExecution cannot be used with structured JSON output\r\n        const response = await client.models.generateContent({\r\n            model: PRIMARY_MODEL,\r\n            contents: prompt,\r\n            config: {\r\n                responseMimeType: 'application/json',\r\n                responseJsonSchema: RecommendationSchema,\r\n            }\r\n        });\r\n\r\n        const responseText = response.text || '{}';\r\n        const result = JSON.parse(responseText);\r\n\r\n        // Map product IDs back to full product objects\r\n        const recommendations: GeminiRecommendation[] = result.recommendations.map((rec: any) => {\r\n            const product = catalog.find(p => p.id === rec.productId);\r\n            if (!product) {\r\n                throw new Error(`Recommended product ${rec.productId} not found`);\r\n            }\r\n            return {\r\n                product,\r\n                score: rec.score,\r\n                reason: rec.reason,\r\n                insights: rec.insights,\r\n                bundleCompatibility: rec.bundleCompatibility\r\n            };\r\n        });\r\n\r\n        // RECALCULATE BUNDLE MATH (ensure correctness via TypeScript)\r\n        if (result.analysis && result.analysis.bundleOpportunities) {\r\n            result.analysis.bundleOpportunities = result.analysis.bundleOpportunities.map((bundle: any) => {\r\n                let totalListPrice = 0;\r\n                bundle.products.forEach((prodIdOrName: string) => {\r\n                    // Try to find by ID or Name (AI might return either)\r\n                    const p = catalog.find(cp => cp.id === prodIdOrName || cp.name === prodIdOrName);\r\n                    if (p) totalListPrice += p.price;\r\n                });\r\n\r\n                // Recalculate expected value if we found the products\r\n                if (totalListPrice > 0) {\r\n                    const discountFactor = 1 - (bundle.discount / 100);\r\n                    bundle.expectedValue = Math.round(totalListPrice * discountFactor);\r\n                }\r\n                return bundle;\r\n            });\r\n        }\r\n\r\n        return {\r\n            recommendations,\r\n            strategy: result.strategy,\r\n            confidence: result.confidence,\r\n            analysis: result.analysis,\r\n            tensorFlowEnhanced: false\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error('Gemini recommendation error:', error);\r\n        throw new Error(`Failed to generate recommendations: ${error}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Enhance Gemini recommendations with TensorFlow similarity scores (optional)\r\n */\r\nexport async function enhanceWithTensorFlow(\r\n    geminiResult: RecommendationResult,\r\n    calculateSimilarity: (a: Product, b: Product, catalog: Product[]) => Promise<number>,\r\n    targetProduct: Product,\r\n    catalog: Product[]\r\n): Promise<RecommendationResult> {\r\n    try {\r\n        // Calculate TF similarity scores for Gemini's recommendations\r\n        const enhanced = await Promise.all(\r\n            geminiResult.recommendations.map(async (rec) => {\r\n                const tfScore = await calculateSimilarity(targetProduct, rec.product, catalog);\r\n\r\n                // Blend Gemini intelligence with TF similarity (70% Gemini, 30% TF)\r\n                const blendedScore = (rec.score * 0.7) + (tfScore * 100 * 0.3);\r\n\r\n                return {\r\n                    ...rec,\r\n                    score: Math.round(blendedScore),\r\n                    insights: [\r\n                        ...rec.insights,\r\n                        `TensorFlow similarity: ${(tfScore * 100).toFixed(1)}%`\r\n                    ]\r\n                };\r\n            })\r\n        );\r\n\r\n        return {\r\n            ...geminiResult,\r\n            recommendations: enhanced,\r\n            tensorFlowEnhanced: true\r\n        };\r\n    } catch (error) {\r\n        console.error('TensorFlow enhancement failed:', error);\r\n        // Return original Gemini result if TF fails\r\n        return geminiResult;\r\n    }\r\n}\r\n\r\n// === HELPER FUNCTIONS ===\r\n\r\nfunction buildRecommendationPrompt(\r\n    targetProduct: Product,\r\n    catalog: Product[],\r\n    request: RecommendationRequest\r\n): string {\r\n    const strategy = request.strategy || 'smart';\r\n    const customerInfo = request.customerProfile\r\n        ? `\\nCustomer Profile:\r\n- Budget: ${request.customerProfile.budget || 'Not specified'}\r\n- Preferences: ${request.customerProfile.preferences?.join(', ') || 'None'}\r\n- Purchase History: ${request.customerProfile.purchaseHistory?.join(', ') || 'None'}`\r\n        : '';\r\n\r\n    return `You are an expert e-commerce recommendation engine.\r\n\r\nTARGET PRODUCT:\r\nName: ${targetProduct.name}\r\nCategory: ${targetProduct.category}\r\nPrice: Γé╣${targetProduct.price}\r\nDescription: ${targetProduct.description}\r\nKeywords: ${targetProduct.keywords.join(', ')}\r\n\r\nAVAILABLE CATALOG:\r\n${catalog.map(p => `- [${p.id}] ${p.name} (${p.category}) - Γé╣${p.price}`).join('\\n')}\r\n\r\nSTRATEGY: ${strategy}\r\n${customerInfo}\r\n${request.context ? `\\nADDITIONAL CONTEXT: ${request.context}` : ''}\r\n\r\nTASK:\r\nGenerate top product recommendations.\r\nMake up a reason, insights, and bundle opportunities.\r\nUse standard strategic analysis.\r\n\r\nReturn structured JSON following the schema.`;\r\n}\r\n\r\n/**\r\n * Cache for generated catalogs (in-memory for now, can move to Redis)\r\n */\r\nlet cachedCatalog: ProductCatalog | null = null;\r\nlet cacheExpiry: Date | null = null;\r\nconst CACHE_TTL_MS = 3600000; // 1 hour\r\n\r\nexport async function getCachedCatalog(\r\n    businessContext: string = 'electronics and accessories e-commerce',\r\n    forceRefresh: boolean = false\r\n): Promise<ProductCatalog> {\r\n    const now = new Date();\r\n\r\n    if (!forceRefresh && cachedCatalog && cacheExpiry && now < cacheExpiry) {\r\n        return cachedCatalog;\r\n    }\r\n\r\n    // Generate fresh catalog\r\n    cachedCatalog = await generateProductCatalog(businessContext);\r\n    cacheExpiry = new Date(now.getTime() + CACHE_TTL_MS);\r\n\r\n    return cachedCatalog;\r\n}\r\n\r\nexport function clearCatalogCache(): void {\r\n    cachedCatalog = null;\r\n    cacheExpiry = null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\hooks.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addThreat' is assigned a value but never used.","line":10,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import useSWR from 'swr';\r\nimport { useSellerOpsStore } from '@/lib/store';\r\nimport type { LiveStatus, ThreatEvent } from '@/lib/types';\r\nimport { useEffect } from 'react';\r\n\r\nconst fetcher = (url: string) => fetch(url).then(res => res.json());\r\n\r\nexport function useRealtimeDashboard() {\r\n    const setLiveStatus = useSellerOpsStore(s => s.setLiveStatus);\r\n    const addThreat = useSellerOpsStore(s => s.addThreat);\r\n\r\n    // Poll /api/status every 2 seconds\r\n    const { data, error } = useSWR<{ status: LiveStatus; threats: ThreatEvent[] }>(\r\n        '/api/status',\r\n        fetcher,\r\n        {\r\n            refreshInterval: 5000,\r\n            dedupingInterval: 2000,\r\n        }\r\n    );\r\n\r\n    // Update global store when data arrives\r\n    useEffect(() => {\r\n        if (data) {\r\n            if (data.status) setLiveStatus(data.status);\r\n\r\n            // Merge threats (simple strategy for demo: just add new ones if we had IDs)\r\n            // For now, let's just reverse the list from API and replace\r\n            // Real app would merge properly\r\n\r\n            // Actually, store supports bulk set? No, just addThreat.\r\n            // Let's iterate and add ANY that we don't have? \r\n            // Or just rely on the API returning the \"Feed\" and we render the feed from SWR directly?\r\n            // The Store is useful for \"Selected Threat\" state.\r\n\r\n            // Let's create a bulk update action in store or just use SWR data in components.\r\n            // Ideally, the Store holds UI state (selection) and Server State (threats).\r\n            // SWR manages Server State better. \r\n            // But we built the Store for threats. Let's sync them for now.\r\n        }\r\n    }, [data, setLiveStatus]);\r\n\r\n    return {\r\n        status: data?.status,\r\n        threats: data?.threats ?? [],\r\n        isLoading: !data && !error,\r\n        error,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\integration.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createSignal' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":22,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"createSignal"},"fix":{"range":[126,177],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { ingestSignal, getDashboardData } from '@/lib/data';\r\nimport { createSignal } from '@/lib/redis/signals';\r\n\r\n// Mock everything \"Real\"\r\nvi.mock('@/lib/redis/client', () => ({\r\n    getRedisClient: vi.fn(() => ({\r\n        publish: vi.fn(),\r\n        on: vi.fn(),\r\n    })),\r\n    publishSignal: vi.fn(),\r\n    getRecentSignals: vi.fn(async () => []),\r\n    updateLiveStatus: vi.fn(),\r\n    getCachedLiveStatus: vi.fn(async () => null),\r\n}));\r\n\r\nvi.mock('@/lib/turso/database', () => ({\r\n    saveSignal: vi.fn(async () => { }),\r\n    saveThreat: vi.fn(async () => { }),\r\n    getRecentThreats: vi.fn(async () => []),\r\n}));\r\n\r\ndescribe('Integration: Data Service', () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it('should ingest valid signal and publish to redis', async () => {\r\n        const result = await ingestSignal('PRICE_CHANGE', 1500);\r\n\r\n        expect(result.signal).toBeDefined();\r\n        // Should publish to Redis (Hot path)\r\n        const { publishSignal } = await import('@/lib/redis/client');\r\n        expect(publishSignal).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should detect threats and save them', async () => {\r\n        // Competitor Price Undercut should trigger threat\r\n        const result = await ingestSignal('COMPETITOR_PRICE', 500, { previousValue: 1000 });\r\n\r\n        expect(result.threat).toBeDefined();\r\n        expect(result.threat?.severity).toBe('CRITICAL');\r\n\r\n        // Should save threat\r\n        const { saveThreat } = await import('@/lib/turso/database');\r\n        expect(saveThreat).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should generate baseline dashboard data if cache miss', async () => {\r\n        const data = await getDashboardData();\r\n\r\n        expect(data.status).toBeDefined();\r\n        expect(data.status.revenueVelocity).toBeGreaterThan(0);\r\n\r\n        // Should update cache\r\n        const { updateLiveStatus } = await import('@/lib/redis/client');\r\n        expect(updateLiveStatus).toHaveBeenCalled();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\redis\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\redis\\connection.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\redis\\signals.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Signal' is defined but never used.","line":11,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Signal"},"fix":{"range":[249,256],"text":""},"desc":"Remove unused variable \"Signal\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SignalId' is defined but never used.","line":11,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":31,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"SignalId"},"fix":{"range":[235,287],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\r\nimport {\r\n    createSignal,\r\n    serializeSignal,\r\n    deserializeSignal,\r\n    detectThreatsFromSignal,\r\n    generateMockSignal,\r\n    CHANNELS,\r\n    KEYS,\r\n} from '@/lib/redis/signals';\r\nimport type { Signal, SignalId } from '@/lib/types';\r\n\r\ndescribe('Redis Signal Client', () => {\r\n    describe('createSignal', () => {\r\n        it('should create a signal with required fields', () => {\r\n            const signal = createSignal('PRICE_CHANGE', 100);\r\n\r\n            expect(signal.id).toBeDefined();\r\n            expect(signal.type).toBe('PRICE_CHANGE');\r\n            expect(signal.value).toBe(100);\r\n            expect(signal.timestamp).toBeInstanceOf(Date);\r\n        });\r\n\r\n        it('should calculate delta from previousValue', () => {\r\n            const signal = createSignal('PRICE_CHANGE', 90, { previousValue: 100 });\r\n\r\n            expect(signal.delta).toBe(-10);\r\n        });\r\n\r\n        it('should use provided delta over calculated', () => {\r\n            const signal = createSignal('PRICE_CHANGE', 90, {\r\n                previousValue: 100,\r\n                delta: -15, // Override\r\n            });\r\n\r\n            expect(signal.delta).toBe(-15);\r\n        });\r\n\r\n        it('should include optional metadata', () => {\r\n            const signal = createSignal('COMPETITOR_PRICE', 85, {\r\n                metadata: { competitor: 'Brand X', source: 'scraper' },\r\n            });\r\n\r\n            expect(signal.metadata).toEqual({ competitor: 'Brand X', source: 'scraper' });\r\n        });\r\n    });\r\n\r\n    describe('serializeSignal / deserializeSignal', () => {\r\n        it('should roundtrip a signal correctly', () => {\r\n            const original = createSignal('REFUND_SPIKE', 12.5, { previousValue: 3 });\r\n\r\n            const serialized = serializeSignal(original);\r\n            const deserialized = deserializeSignal(serialized);\r\n\r\n            expect(deserialized.id).toBe(original.id);\r\n            expect(deserialized.type).toBe(original.type);\r\n            expect(deserialized.value).toBe(original.value);\r\n            expect(deserialized.timestamp.getTime()).toBe(original.timestamp.getTime());\r\n        });\r\n\r\n        it('should produce valid JSON', () => {\r\n            const signal = createSignal('STOCK_ALERT', 5);\r\n            const serialized = serializeSignal(signal);\r\n\r\n            expect(() => JSON.parse(serialized)).not.toThrow();\r\n        });\r\n    });\r\n\r\n    describe('detectThreatsFromSignal', () => {\r\n        it('should detect CRITICAL refund spike', () => {\r\n            const signal = createSignal('REFUND_SPIKE', 8); // > 5%\r\n\r\n            const threat = detectThreatsFromSignal(signal);\r\n\r\n            expect(threat).not.toBeNull();\r\n            expect(threat?.severity).toBe('CRITICAL');\r\n            expect(threat?.shouldAlert).toBe(true);\r\n        });\r\n\r\n        it('should not alert for normal refund rate', () => {\r\n            const signal = createSignal('REFUND_SPIKE', 2); // < 5%\r\n\r\n            const threat = detectThreatsFromSignal(signal);\r\n\r\n            expect(threat).toBeNull();\r\n        });\r\n\r\n        it('should detect conversion drop', () => {\r\n            const signal = createSignal('CONVERSION_DROP', 2, { previousValue: 4 }); // 50% drop\r\n\r\n            const threat = detectThreatsFromSignal(signal);\r\n\r\n            expect(threat).not.toBeNull();\r\n            expect(threat?.severity).toBe('WARNING');\r\n        });\r\n\r\n        it('should detect competitor price undercut', () => {\r\n            const signal = createSignal('COMPETITOR_PRICE', 85, { previousValue: 100 });\r\n\r\n            const threat = detectThreatsFromSignal(signal);\r\n\r\n            expect(threat).not.toBeNull();\r\n            expect(threat?.severity).toBe('CRITICAL');\r\n        });\r\n\r\n        it('should detect low stock', () => {\r\n            const signal = createSignal('STOCK_ALERT', 5); // < 10\r\n\r\n            const threat = detectThreatsFromSignal(signal);\r\n\r\n            expect(threat).not.toBeNull();\r\n            expect(threat?.severity).toBe('WARNING');\r\n        });\r\n    });\r\n\r\n    describe('generateMockSignal', () => {\r\n        it('should generate valid signals', () => {\r\n            const signal = generateMockSignal();\r\n\r\n            expect(signal.id).toBeDefined();\r\n            expect(signal.type).toBeDefined();\r\n            expect(typeof signal.value).toBe('number');\r\n            expect(signal.timestamp).toBeInstanceOf(Date);\r\n        });\r\n\r\n        it('should generate different signals', () => {\r\n            const signals = Array.from({ length: 10 }, () => generateMockSignal());\r\n            const uniqueTypes = new Set(signals.map(s => s.type));\r\n\r\n            // Should have some variety\r\n            expect(uniqueTypes.size).toBeGreaterThan(1);\r\n        });\r\n    });\r\n\r\n    describe('CHANNELS and KEYS', () => {\r\n        it('should have all required channel names', () => {\r\n            expect(CHANNELS.THREATS).toBe('sellerops:threats');\r\n            expect(CHANNELS.SIGNALS).toBe('sellerops:signals');\r\n            expect(CHANNELS.STATUS).toBe('sellerops:status');\r\n        });\r\n\r\n        it('should have all required key patterns', () => {\r\n            expect(KEYS.SIGNAL_PREFIX).toBe('signal:');\r\n            expect(KEYS.THREAT_PREFIX).toBe('threat:');\r\n            expect(KEYS.STATUS).toBe('live:status');\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\redis\\signals.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":165,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":165,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5148,5151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5148,5151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":169,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":169,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5267,5270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5267,5270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Redis Signal Client\r\n * Real-time signal intake and caching for SellerOps\r\n * Uses Redis MCP server connection\r\n */\r\n\r\nimport type { Signal, SignalId, SignalType } from '@/lib/types';\r\n\r\n// === SIGNAL CHANNEL NAMES ===\r\nexport const CHANNELS = {\r\n    THREATS: 'sellerops:threats',\r\n    SIGNALS: 'sellerops:signals',\r\n    STATUS: 'sellerops:status',\r\n} as const;\r\n\r\n// === KEY PATTERNS ===\r\nexport const KEYS = {\r\n    SIGNAL_PREFIX: 'signal:',\r\n    THREAT_PREFIX: 'threat:',\r\n    STATUS: 'live:status',\r\n    SIGNAL_QUEUE: 'queue:signals',\r\n} as const;\r\n\r\n// === SIGNAL SERIALIZATION ===\r\nexport function serializeSignal(signal: Signal): string {\r\n    return JSON.stringify({\r\n        ...signal,\r\n        timestamp: signal.timestamp.toISOString(),\r\n    });\r\n}\r\n\r\nexport function deserializeSignal(data: string): Signal {\r\n    const parsed = JSON.parse(data);\r\n    return {\r\n        ...parsed,\r\n        timestamp: new Date(parsed.timestamp),\r\n    };\r\n}\r\n\r\n// === SIGNAL FACTORY ===\r\nexport function createSignal(\r\n    type: SignalType,\r\n    value: number,\r\n    options?: {\r\n        previousValue?: number;\r\n        delta?: number;\r\n        skuId?: string;\r\n        metadata?: Record<string, unknown>;\r\n    }\r\n): Signal {\r\n    return {\r\n        id: `sig-${Date.now()}-${Math.random().toString(36).substring(7)}` as SignalId,\r\n        type,\r\n        timestamp: new Date(),\r\n        value,\r\n        previousValue: options?.previousValue,\r\n        delta: options?.delta ?? (options?.previousValue !== undefined\r\n            ? value - options.previousValue\r\n            : undefined\r\n        ),\r\n        skuId: options?.skuId as Signal['skuId'],\r\n        metadata: options?.metadata,\r\n    };\r\n}\r\n\r\n// === SIGNAL DETECTION RULES ===\r\nexport interface SignalRule {\r\n    type: SignalType;\r\n    condition: (value: number, previousValue?: number) => boolean;\r\n    severity: 'CRITICAL' | 'WARNING' | 'INFO';\r\n    getMessage: (value: number, delta?: number) => string;\r\n}\r\n\r\nexport const SIGNAL_RULES: SignalRule[] = [\r\n    {\r\n        type: 'PRICE_CHANGE',\r\n        condition: (_, prev) => prev !== undefined,\r\n        severity: 'WARNING',\r\n        getMessage: (value, delta) =>\r\n            `Price ${delta && delta > 0 ? 'increased' : 'decreased'} to Γé╣${value}`,\r\n    },\r\n    {\r\n        type: 'REFUND_SPIKE',\r\n        condition: (value) => value > 5, // More than 5% refund rate\r\n        severity: 'CRITICAL',\r\n        getMessage: (value) => `Refund rate spiked to ${value}%`,\r\n    },\r\n    {\r\n        type: 'CONVERSION_DROP',\r\n        condition: (value, prev) => prev !== undefined && value < prev * 0.8,\r\n        severity: 'WARNING',\r\n        getMessage: (value) => `Conversion dropped to ${value}%`,\r\n    },\r\n    {\r\n        type: 'COMPETITOR_PRICE',\r\n        condition: (value, prev) => prev !== undefined && value < prev,\r\n        severity: 'CRITICAL',\r\n        getMessage: (value) => `Competitor undercut to Γé╣${value}`,\r\n    },\r\n    {\r\n        type: 'SEARCH_DROP',\r\n        condition: (value, prev) => prev !== undefined && value < prev * 0.7,\r\n        severity: 'WARNING',\r\n        getMessage: (value) => `Search visibility dropped to ${value}%`,\r\n    },\r\n    {\r\n        type: 'STOCK_ALERT',\r\n        condition: (value) => value < 10, // Less than 10 units\r\n        severity: 'WARNING',\r\n        getMessage: (value) => `Low stock: ${value} units remaining`,\r\n    },\r\n];\r\n\r\n// === DETECT THREATS FROM SIGNALS ===\r\nexport function detectThreatsFromSignal(signal: Signal): {\r\n    shouldAlert: boolean;\r\n    severity: 'CRITICAL' | 'WARNING' | 'INFO';\r\n    message: string;\r\n} | null {\r\n    const rule = SIGNAL_RULES.find(r => r.type === signal.type);\r\n    if (!rule) return null;\r\n\r\n    if (rule.condition(signal.value, signal.previousValue)) {\r\n        return {\r\n            shouldAlert: true,\r\n            severity: rule.severity,\r\n            message: rule.getMessage(signal.value, signal.delta),\r\n        };\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n// === MOCK SIGNAL GENERATOR (For demo) ===\r\nexport function generateMockSignal(): Signal {\r\n    const types: SignalType[] = [\r\n        'PRICE_CHANGE',\r\n        'REFUND_SPIKE',\r\n        'CONVERSION_DROP',\r\n        'COMPETITOR_PRICE',\r\n        'SEARCH_DROP',\r\n    ];\r\n\r\n    const type = types[Math.floor(Math.random() * types.length)];\r\n    const baseValues: Record<SignalType, { min: number; max: number }> = {\r\n        PRICE_CHANGE: { min: 800, max: 1500 },\r\n        REFUND_SPIKE: { min: 1, max: 15 },\r\n        CONVERSION_DROP: { min: 1, max: 5 },\r\n        COMPETITOR_PRICE: { min: 700, max: 1400 },\r\n        SEARCH_DROP: { min: 20, max: 100 },\r\n        CART_ABANDONMENT: { min: 50, max: 90 },\r\n        SHIPPING_DELAY: { min: 1, max: 7 },\r\n        STOCK_ALERT: { min: 0, max: 50 },\r\n    };\r\n\r\n    const range = baseValues[type];\r\n    const value = Math.floor(Math.random() * (range.max - range.min) + range.min);\r\n    const previousValue = Math.floor(Math.random() * (range.max - range.min) + range.min);\r\n\r\n    return createSignal(type, value, { previousValue });\r\n}\r\n\r\n// === EXPORT PLACEHOLDERS FOR COMPATIBILITY ===\r\n// These are now implemented in unified-client.ts\r\nexport function publishSignal(data: any): Promise<void> {\r\n    throw new Error('Use unified-client.ts instead');\r\n}\r\n\r\nexport function publishThreat(data: any): Promise<void> {\r\n    throw new Error('Use unified-client.ts instead');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\redis\\unified-client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[792,795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[792,795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[816,819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[816,819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":32,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":32,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3120,3123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3120,3123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3144,3147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3144,3147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":112,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":112,"endColumn":43}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unified Redis Client\r\n * Supports both local ioredis (dev) and Upstash (production/Vercel)\r\n */\r\n\r\nimport { CHANNELS, KEYS } from './signals';\r\n\r\n// Conditional imports based on environment\r\nconst isUpstashConfigured = !!(\r\n  process.env.UPSTASH_REDIS_REST_URL && \r\n  process.env.UPSTASH_REDIS_REST_TOKEN\r\n);\r\n\r\n// Flag to determine which client to use\r\nconst USE_UPSTASH = isUpstashConfigured || process.env.NODE_ENV === 'production';\r\n\r\n// === REDIS CLIENT WRAPPER ===\r\n\r\ninterface RedisClient {\r\n  publishSignal(signalJson: string): Promise<void>;\r\n  getRecentSignals(count: number): Promise<string[]>;\r\n  updateLiveStatus(statusJson: string): Promise<void>;\r\n  getCachedLiveStatus(): Promise<string | null>;\r\n}\r\n\r\nclass LocalRedisClient implements RedisClient {\r\n  private Redis: any;\r\n  private client: any = null;\r\n\r\n  constructor() {\r\n    // Lazy load ioredis only if needed\r\n    this.Redis = require('ioredis').default;\r\n  }\r\n\r\n  private getClient() {\r\n    if (!this.client) {\r\n      const REDIS_URL = process.env.REDIS_URL || 'redis://localhost:6379';\r\n      this.client = new this.Redis(REDIS_URL, {\r\n        maxRetriesPerRequest: 3,\r\n        retryStrategy(times: number) {\r\n          const delay = Math.min(times * 50, 2000);\r\n          return delay;\r\n        },\r\n        reconnectOnError: (err: Error) => {\r\n          if (err.message.includes('READONLY')) {\r\n            return true;\r\n          }\r\n          return false;\r\n        },\r\n      });\r\n\r\n      this.client.on('error', (err: Error) => {\r\n        console.warn('[Redis] Connection error:', err.message);\r\n      });\r\n\r\n      this.client.on('connect', () => {\r\n        console.log('[Redis] Connected to War Room signal stream');\r\n      });\r\n    }\r\n    return this.client;\r\n  }\r\n\r\n  async publishSignal(signalJson: string): Promise<void> {\r\n    try {\r\n      const client = this.getClient();\r\n      const pipeline = client.pipeline();\r\n      pipeline.publish(CHANNELS.SIGNALS, signalJson);\r\n      pipeline.lpush(KEYS.SIGNAL_QUEUE, signalJson);\r\n      pipeline.ltrim(KEYS.SIGNAL_QUEUE, 0, 999);\r\n      await pipeline.exec();\r\n    } catch (error) {\r\n      console.error('[LocalRedis] Publish failed:', error);\r\n    }\r\n  }\r\n\r\n  async getRecentSignals(count: number): Promise<string[]> {\r\n    try {\r\n      const client = this.getClient();\r\n      return await client.lrange(KEYS.SIGNAL_QUEUE, 0, count - 1);\r\n    } catch (error) {\r\n      console.error('[LocalRedis] Get signals failed:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async updateLiveStatus(statusJson: string): Promise<void> {\r\n    try {\r\n      const client = this.getClient();\r\n      await client.set(KEYS.STATUS, statusJson, 'EX', 60);\r\n    } catch (error) {\r\n      console.error('[LocalRedis] Update status failed:', error);\r\n    }\r\n  }\r\n\r\n  async getCachedLiveStatus(): Promise<string | null> {\r\n    try {\r\n      const client = this.getClient();\r\n      return await client.get(KEYS.STATUS);\r\n    } catch (error) {\r\n      console.error('[LocalRedis] Get status failed:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n\r\nclass UpstashRedisClient implements RedisClient {\r\n  private Redis: any;\r\n  private client: any = null;\r\n\r\n  constructor() {\r\n    // Lazy load @upstash/redis only if needed\r\n    this.Redis = require('@upstash/redis').Redis;\r\n  }\r\n\r\n  private getClient() {\r\n    if (!this.client) {\r\n      this.client = new this.Redis({\r\n        url: process.env.UPSTASH_REDIS_REST_URL!,\r\n        token: process.env.UPSTASH_REDIS_REST_TOKEN!,\r\n      });\r\n    }\r\n    return this.client;\r\n  }\r\n\r\n  async publishSignal(signalJson: string): Promise<void> {\r\n    try {\r\n      const client = this.getClient();\r\n      // Upstash doesn't support pipelines, run sequentially\r\n      await client.publish(CHANNELS.SIGNALS, signalJson);\r\n      await client.lpush(KEYS.SIGNAL_QUEUE, signalJson);\r\n      await client.ltrim(KEYS.SIGNAL_QUEUE, 0, 999);\r\n    } catch (error) {\r\n      console.error('[Upstash] Publish failed:', error);\r\n    }\r\n  }\r\n\r\n  async getRecentSignals(count: number): Promise<string[]> {\r\n    try {\r\n      const client = this.getClient();\r\n      const result = await client.lrange(KEYS.SIGNAL_QUEUE, 0, count - 1);\r\n      return result || [];\r\n    } catch (error) {\r\n      console.error('[Upstash] Get signals failed:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async updateLiveStatus(statusJson: string): Promise<void> {\r\n    try {\r\n      const client = this.getClient();\r\n      await client.set(KEYS.STATUS, statusJson, { ex: 60 });\r\n    } catch (error) {\r\n      console.error('[Upstash] Update status failed:', error);\r\n    }\r\n  }\r\n\r\n  async getCachedLiveStatus(): Promise<string | null> {\r\n    try {\r\n      const client = this.getClient();\r\n      return await client.get(KEYS.STATUS);\r\n    } catch (error) {\r\n      console.error('[Upstash] Get status failed:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n\r\n// Fallback client (no Redis, graceful degradation)\r\nclass FallbackRedisClient implements RedisClient {\r\n  private inMemorySignals: string[] = [];\r\n  private inMemoryStatus: string | null = null;\r\n\r\n  async publishSignal(signalJson: string): Promise<void> {\r\n    console.warn('[Fallback] Using in-memory signal storage (Redis unavailable)');\r\n    this.inMemorySignals.unshift(signalJson);\r\n    if (this.inMemorySignals.length > 1000) {\r\n      this.inMemorySignals = this.inMemorySignals.slice(0, 1000);\r\n    }\r\n  }\r\n\r\n  async getRecentSignals(count: number): Promise<string[]> {\r\n    return this.inMemorySignals.slice(0, count);\r\n  }\r\n\r\n  async updateLiveStatus(statusJson: string): Promise<void> {\r\n    this.inMemoryStatus = statusJson;\r\n  }\r\n\r\n  async getCachedLiveStatus(): Promise<string | null> {\r\n    return this.inMemoryStatus;\r\n  }\r\n}\r\n\r\n// === SINGLETON INSTANCE ===\r\nlet redisClient: RedisClient | null = null;\r\n\r\nfunction initializeRedisClient(): RedisClient {\r\n  if (USE_UPSTASH) {\r\n    console.log('[Redis] Using Upstash (serverless mode)');\r\n    return new UpstashRedisClient();\r\n  } else if (process.env.REDIS_URL || process.env.NODE_ENV === 'development') {\r\n    console.log('[Redis] Using local ioredis');\r\n    return new LocalRedisClient();\r\n  } else {\r\n    console.warn('[Redis] No Redis configured, using fallback mode');\r\n    return new FallbackRedisClient();\r\n  }\r\n}\r\n\r\nexport function getRedisClient(): RedisClient {\r\n  if (!redisClient) {\r\n    redisClient = initializeRedisClient();\r\n  }\r\n  return redisClient;\r\n}\r\n\r\n// === PUBLIC API ===\r\n\r\nexport async function publishSignal(signalJson: string): Promise<void> {\r\n  const client = getRedisClient();\r\n  await client.publishSignal(signalJson);\r\n}\r\n\r\nexport async function getRecentSignals(count: number = 10): Promise<string[]> {\r\n  const client = getRedisClient();\r\n  return await client.getRecentSignals(count);\r\n}\r\n\r\nexport async function updateLiveStatus(statusJson: string): Promise<void> {\r\n  const client = getRedisClient();\r\n  await client.updateLiveStatus(statusJson);\r\n}\r\n\r\nexport async function getCachedLiveStatus(): Promise<string | null> {\r\n  const client = getRedisClient();\r\n  return await client.getCachedLiveStatus();\r\n}\r\n\r\n// === UTILITY ===\r\n\r\nexport function getRedisMode(): 'upstash' | 'local' | 'fallback' {\r\n  if (USE_UPSTASH) return 'upstash';\r\n  if (process.env.REDIS_URL || process.env.NODE_ENV === 'development') return 'local';\r\n  return 'fallback';\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\redis\\upstash.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\simulation\\engine.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\simulation\\engine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\store.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\store.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'get' is defined but never used.","line":11,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport type {\r\n    SellerOpsState,\r\n    LiveStatus,\r\n    ThreatEvent,\r\n    AttributionBrief,\r\n    SimulationParams,\r\n    SimulationResult\r\n} from '@/lib/types';\r\n\r\nexport const useSellerOpsStore = create<SellerOpsState>((set, get) => ({\r\n    // Initial State\r\n    liveStatus: null,\r\n    threats: [],\r\n    selectedThreat: null,\r\n    currentBrief: null,\r\n    isLoadingBrief: false,\r\n    simulationResult: null,\r\n    isSimulating: false,\r\n\r\n    // Actions\r\n    setLiveStatus: (status: LiveStatus) => set({ liveStatus: status }),\r\n\r\n    addThreat: (threat: ThreatEvent) =>\r\n        set((state) => ({\r\n            threats: [threat, ...state.threats].slice(0, 50) // Keep last 50\r\n        })),\r\n\r\n    setThreats: (threats: ThreatEvent[]) => set({ threats }),\r\n\r\n    selectThreat: (threat: ThreatEvent | null) =>\r\n        set({ selectedThreat: threat, currentBrief: null }),\r\n\r\n    setAttributionBrief: (brief: AttributionBrief | null) =>\r\n        set({ currentBrief: brief, isLoadingBrief: false }),\r\n\r\n    runSimulation: async (params: SimulationParams) => {\r\n        set({ isSimulating: true });\r\n\r\n        try {\r\n            // Call simulation API\r\n            const response = await fetch('/api/simulate', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(params),\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Simulation failed');\r\n\r\n            const result: SimulationResult = await response.json();\r\n            set({ simulationResult: result, isSimulating: false });\r\n        } catch (error) {\r\n            console.error('Simulation error:', error);\r\n            set({ isSimulating: false });\r\n        }\r\n    },\r\n}));\r\n\r\n// Selectors for performance optimization\r\nexport const useLiveStatus = () => useSellerOpsStore((s) => s.liveStatus);\r\nexport const useThreats = () => useSellerOpsStore((s) => s.threats);\r\nexport const useSelectedThreat = () => useSellerOpsStore((s) => s.selectedThreat);\r\nexport const useAttributionBrief = () => useSellerOpsStore((s) => s.currentBrief);\r\nexport const useSimulationResult = () => useSellerOpsStore((s) => s.simulationResult);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\tensorflow\\recommendation-engine.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\tensorflow\\recommendation-engine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\turso\\database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\lib\\types\\types.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SignalType' is defined but never used.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SignalType"},"fix":{"range":[116,133],"text":""},"desc":"Remove unused variable \"SignalType\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SeverityLevel' is defined but never used.","line":7,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SeverityLevel"},"fix":{"range":[133,153],"text":""},"desc":"Remove unused variable \"SeverityLevel\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, expectTypeOf } from 'vitest';\r\nimport type {\r\n    SignalId,\r\n    ThreatId,\r\n    SKUId,\r\n    SignalType,\r\n    SeverityLevel,\r\n    Signal,\r\n    ThreatEvent,\r\n    AttributionBrief,\r\n    SimulationParams,\r\n    SimulationResult,\r\n    LiveStatus,\r\n} from '@/lib/types';\r\n\r\ndescribe('Type Definitions', () => {\r\n    describe('Branded Types', () => {\r\n        it('SignalId should be a branded string', () => {\r\n            const id = 'sig-123' as SignalId;\r\n            expectTypeOf(id).toMatchTypeOf<string>();\r\n        });\r\n\r\n        it('ThreatId should be a branded string', () => {\r\n            const id = 'threat-456' as ThreatId;\r\n            expectTypeOf(id).toMatchTypeOf<string>();\r\n        });\r\n\r\n        it('SKUId should be a branded string', () => {\r\n            const id = 'sku-789' as SKUId;\r\n            expectTypeOf(id).toMatchTypeOf<string>();\r\n        });\r\n    });\r\n\r\n    describe('Signal', () => {\r\n        it('should have required properties', () => {\r\n            const signal: Signal = {\r\n                id: 'sig-1' as SignalId,\r\n                type: 'PRICE_CHANGE',\r\n                timestamp: new Date(),\r\n                value: 100,\r\n            };\r\n\r\n            expect(signal.id).toBeDefined();\r\n            expect(signal.type).toBeDefined();\r\n            expect(signal.timestamp).toBeInstanceOf(Date);\r\n            expect(typeof signal.value).toBe('number');\r\n        });\r\n\r\n        it('should allow optional properties', () => {\r\n            const signal: Signal = {\r\n                id: 'sig-2' as SignalId,\r\n                type: 'COMPETITOR_PRICE',\r\n                timestamp: new Date(),\r\n                value: 95,\r\n                previousValue: 100,\r\n                delta: -5,\r\n                skuId: 'sku-123' as SKUId,\r\n                metadata: { competitor: 'Brand X' },\r\n            };\r\n\r\n            expect(signal.previousValue).toBe(100);\r\n            expect(signal.delta).toBe(-5);\r\n            expect(signal.skuId).toBeDefined();\r\n            expect(signal.metadata).toBeDefined();\r\n        });\r\n    });\r\n\r\n    describe('ThreatEvent', () => {\r\n        it('should have all required fields', () => {\r\n            const threat: ThreatEvent = {\r\n                id: 'threat-1' as ThreatId,\r\n                severity: 'CRITICAL',\r\n                title: 'Buy Box Lost',\r\n                description: 'Competitor undercut price',\r\n                signals: ['sig-1' as SignalId],\r\n                detectedAt: new Date(),\r\n                confidence: 95,\r\n            };\r\n\r\n            expect(threat.id).toBeDefined();\r\n            expect(['CRITICAL', 'WARNING', 'INFO', 'OK']).toContain(threat.severity);\r\n            expect(threat.title).toBeTruthy();\r\n            expect(threat.description).toBeTruthy();\r\n            expect(Array.isArray(threat.signals)).toBe(true);\r\n            expect(threat.detectedAt).toBeInstanceOf(Date);\r\n            expect(threat.confidence).toBeGreaterThanOrEqual(0);\r\n            expect(threat.confidence).toBeLessThanOrEqual(100);\r\n        });\r\n\r\n        it('should allow optional suggestedAction', () => {\r\n            const threat: ThreatEvent = {\r\n                id: 'threat-2' as ThreatId,\r\n                severity: 'WARNING',\r\n                title: 'Test',\r\n                description: 'Test',\r\n                signals: [],\r\n                detectedAt: new Date(),\r\n                confidence: 70,\r\n                suggestedAction: 'Lower price by 5%',\r\n            };\r\n\r\n            expect(threat.suggestedAction).toBe('Lower price by 5%');\r\n        });\r\n    });\r\n\r\n    describe('SimulationParams', () => {\r\n        it('should have all three adjustment parameters', () => {\r\n            const params: SimulationParams = {\r\n                priceChange: -5,\r\n                adSpendChange: 20,\r\n                shippingSpeedChange: -1,\r\n            };\r\n\r\n            expect(typeof params.priceChange).toBe('number');\r\n            expect(typeof params.adSpendChange).toBe('number');\r\n            expect(typeof params.shippingSpeedChange).toBe('number');\r\n        });\r\n    });\r\n\r\n    describe('SimulationResult', () => {\r\n        it('should contain all projected metrics', () => {\r\n            const result: SimulationResult = {\r\n                params: { priceChange: 0, adSpendChange: 0, shippingSpeedChange: 0 },\r\n                projectedRevenue: 50000,\r\n                projectedMargin: 22,\r\n                projectedVolume: 500,\r\n                competitorResponseProbability: 20,\r\n                riskLevel: 'OK',\r\n                timestamp: new Date(),\r\n            };\r\n\r\n            expect(result.projectedRevenue).toBeGreaterThan(0);\r\n            expect(result.projectedMargin).toBeDefined();\r\n            expect(result.projectedVolume).toBeDefined();\r\n            expect(result.competitorResponseProbability).toBeGreaterThanOrEqual(0);\r\n            expect(result.competitorResponseProbability).toBeLessThanOrEqual(100);\r\n            expect(['CRITICAL', 'WARNING', 'INFO', 'OK']).toContain(result.riskLevel);\r\n        });\r\n    });\r\n\r\n    describe('LiveStatus', () => {\r\n        it('should contain real-time metrics', () => {\r\n            const status: LiveStatus = {\r\n                revenueVelocity: 3500,\r\n                revenueDirection: 'UP',\r\n                riskScore: 45,\r\n                opportunityScore: 60,\r\n                activeThreats: 2,\r\n                lastUpdated: new Date(),\r\n            };\r\n\r\n            expect(status.revenueVelocity).toBeGreaterThanOrEqual(0);\r\n            expect(['UP', 'DOWN', 'STABLE']).toContain(status.revenueDirection);\r\n            expect(status.riskScore).toBeGreaterThanOrEqual(0);\r\n            expect(status.opportunityScore).toBeGreaterThanOrEqual(0);\r\n            expect(status.activeThreats).toBeGreaterThanOrEqual(0);\r\n            expect(status.lastUpdated).toBeInstanceOf(Date);\r\n        });\r\n    });\r\n\r\n    describe('AttributionBrief', () => {\r\n        it('should have Gemini-generated fields', () => {\r\n            const brief: AttributionBrief = {\r\n                threatId: 'threat-1' as ThreatId,\r\n                summary: 'Analysis of the threat...',\r\n                causes: [\r\n                    { factor: 'Price Drop', impact: 'HIGH', evidence: 'Signal data shows...' },\r\n                ],\r\n                suggestedActions: [\r\n                    { action: 'Match price', priority: 'IMMEDIATE', expectedOutcome: 'Regain Buy Box' },\r\n                ],\r\n                confidence: 87,\r\n                generatedAt: new Date(),\r\n            };\r\n\r\n            expect(brief.threatId).toBeDefined();\r\n            expect(brief.summary).toBeTruthy();\r\n            expect(brief.causes.length).toBeGreaterThan(0);\r\n            expect(brief.suggestedActions.length).toBeGreaterThan(0);\r\n            expect(brief.confidence).toBeGreaterThanOrEqual(0);\r\n            expect(brief.confidence).toBeLessThanOrEqual(100);\r\n            expect(brief.generatedAt).toBeInstanceOf(Date);\r\n        });\r\n\r\n        it('causes should have proper impact levels', () => {\r\n            const causes = [\r\n                { factor: 'Test', impact: 'HIGH' as const, evidence: 'Data' },\r\n                { factor: 'Test2', impact: 'MEDIUM' as const, evidence: 'Data' },\r\n                { factor: 'Test3', impact: 'LOW' as const, evidence: 'Data' },\r\n            ];\r\n\r\n            causes.forEach(cause => {\r\n                expect(['HIGH', 'MEDIUM', 'LOW']).toContain(cause.impact);\r\n            });\r\n        });\r\n\r\n        it('actions should have proper priority levels', () => {\r\n            const actions = [\r\n                { action: 'Act', priority: 'IMMEDIATE' as const, expectedOutcome: 'Result' },\r\n                { action: 'Act2', priority: 'SOON' as const, expectedOutcome: 'Result' },\r\n                { action: 'Act3', priority: 'OPTIONAL' as const, expectedOutcome: 'Result' },\r\n            ];\r\n\r\n            actions.forEach(action => {\r\n                expect(['IMMEDIATE', 'SOON', 'OPTIONAL']).toContain(action.priority);\r\n            });\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Admin\\Desktop\\lava\\seller-ops\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
